<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 å®¸å®¸æ˜Ÿæ˜Ÿæ›¼è°·å¤§å†’éšª</title>
    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4AA3DF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png"> 
    
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. åŸºç¤ CSS --- */
        :root {
            --primary-color: #4AA3DF;
            --accent-color: #FFD700;
            --bg-color: #E0F7FA;
            --text-color: #444;
            --card-bg: rgba(255, 255, 255, 0.95);
            --nav-height: 85px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Itim', 'Noto Sans TC', cursive, sans-serif;
            margin: 0; padding: 0;
            background-image: url('èƒŒæ™¯åœ–.png'); 
            background-size: 300px; background-repeat: repeat; background-attachment: fixed;
            background-color: var(--bg-color); color: var(--text-color);
            padding-bottom: calc(var(--nav-height) + 20px); font-size: 16px;
            overscroll-behavior-y: contain; 
        }

        /* --- ğŸŒŸ è±ªè¯éå ´å‹•ç•« (Splash Screen) --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #B3E5FC 0%, #E1F5FE 100%); /* Baby Blue */
            background-image: url('pattern1.png'); /* è‹¥ç„¡æ­¤åœ–é¡¯ç¤ºæ¼¸å±¤ */
            background-size: 300px; background-blend-mode: overlay;
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-out;
            text-align: center;
        }
        .splash-icon {
            width: 250px; height: 250px; border-radius: 50px; object-fit: cover;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15); margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
            background: white;
        }
        .splash-plane { 
            position: absolute; width: 200px; z-index: 25; filter: drop-shadow(10px 10px 5px rgba(0,0,0,0.1));
            animation: planeFly 5s linear forwards; pointer-events: none;
        }
        @keyframes planeFly { 
            0% { left: -30vw; bottom: -30vh; transform: rotate(-35deg) scale(0.8); } 
            100% { left: 130vw; bottom: 130vh; transform: rotate(-35deg) scale(1.2); } 
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        
        .loading-dots span {
            display: inline-block; width: 15px; height: 15px; border-radius: 50%; margin: 0 5px;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .loading-dots span:nth-child(1) { background: #FF9800; animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { background: #FFEB3B; animation-delay: -0.16s; }
        .loading-dots span:nth-child(3) { background: #4CAF50; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        #start-btn {
            margin-top: 30px; font-size: 1.5rem; padding: 12px 50px; 
            background: var(--accent-color); color: #5d4037; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: none; cursor: pointer;
            animation: breathe 2s infinite; font-weight: bold;
        }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* --- ä¸»ä»‹é¢å‹•æ…‹ç‰¹æ•ˆ --- */
        header {
            background: rgba(255, 255, 255, 0.92); padding: 15px 10px; text-align: center;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
            box-shadow: 0 4px 15px rgba(74, 163, 223, 0.15); 
            position: sticky; top: 0; z-index: 100;
            padding-top: env(safe-area-inset-top); 
            backdrop-filter: blur(8px);
        }
        h1 { 
            margin: 0; font-size: 1.2rem; color: var(--primary-color); 
            display: flex; align-items: center; justify-content: center; gap: 8px; 
            animation: float 4s ease-in-out infinite; padding-top: 5px;
        }
        .header-icon { height: 35px; width: auto; mix-blend-mode: multiply; }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        .card {
            background: var(--card-bg); border-radius: 25px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05); border: 2px solid #fff; 
            transition: transform 0.2s; animation: slideUp 0.5s;
        }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Q å½ˆæŒ‰éˆ• */
        button {
            background-color: var(--primary-color); color: white; border: none; padding: 10px 20px;
            border-radius: 50px; font-family: inherit; cursor: pointer; font-size: 0.95rem; font-weight: bold;
            box-shadow: 0 4px 10px rgba(74, 163, 223, 0.3); transition: all 0.2s;
        }
        button:active { transform: scale(0.9); }
        button.secondary { background-color: #FFB74D; box-shadow: 0 4px 10px rgba(255, 183, 77, 0.4); }
        button.danger { background-color: #FF7043; box-shadow: 0 4px 10px rgba(255, 112, 67, 0.4); }
        button.success { background-color: #66BB6A; box-shadow: 0 4px 10px rgba(102, 187, 106, 0.4); }
        button.outline { background: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); box-shadow: none; }
        button.icon-btn { padding: 6px 12px; border-radius: 15px; font-size: 1.1rem; }
        button.full-width { width: 100%; margin-top: 15px; animation: breathe 3s infinite; }
        @keyframes breathe { 0%, 100% { box-shadow: 0 4px 10px rgba(74, 163, 223, 0.3); } 50% { box-shadow: 0 4px 20px rgba(74, 163, 223, 0.6); } }

        input, textarea, select {
            width: 100%; padding: 12px; margin: 8px 0 15px 0; border: 2px solid #eee;
            border-radius: 15px; font-family: inherit; background: #fff; transition: 0.3s;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(74, 163, 223, 0.1); }
        textarea { resize: vertical; min-height: 80px; }
        label { font-weight: bold; color: #555; font-size: 0.9rem; display: block; margin-top: 12px; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: rgba(255, 255, 255, 0.98); display: flex; overflow-x: auto; align-items: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000; padding: 0 5px;
            -ms-overflow-style: none; scrollbar-width: none;
            padding-bottom: env(safe-area-inset-bottom);
            border-top-left-radius: 25px; border-top-right-radius: 25px;
        }
        .bottom-nav::-webkit-scrollbar { display: none; }
        .nav-item {
            flex: 0 0 auto; width: 68px; text-align: center; padding: 5px; font-size: 0.7rem;
            color: #999; cursor: pointer; border-radius: 20px; margin: 0 3px; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .nav-item.active { background-color: rgba(74, 163, 223, 0.15); color: var(--primary-color); font-weight: bold; transform: translateY(-5px); }
        .nav-icon-img { width: 34px; height: 34px; object-fit: contain; margin-bottom: 4px; display: block; mix-blend-mode: multiply; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .info-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding: 12px 0; align-items: baseline; }
        .info-label { color: #888; font-size: 0.9rem; min-width: 90px; font-weight: bold; }
        .info-value { font-weight: 500; text-align: right; flex-grow: 1; word-break: break-all; color: #444; }
        .section-title { 
            color: var(--primary-color); font-size: 1.15rem; font-weight: bold;
            border-bottom: 3px solid var(--accent-color); padding-bottom: 6px; margin: 20px 0 15px 0; display: inline-block; 
        }
        .edit-controls { text-align: right; margin-bottom: 10px; }
        .edit-group { background: #f8fbfd; padding: 20px; border-radius: 20px; margin-bottom: 15px; border: 2px solid #eef6fb; position: relative; }
        .delete-btn-corner { position: absolute; top: 10px; right: 10px; font-size: 0.8rem; background: #FF7043; color: white; padding: 4px 10px; border-radius: 15px;}
        
        /* è¡Œç¨‹åˆ†é  (Tabs) */
        .date-tabs-container { display: flex; overflow-x: auto; gap: 10px; padding: 5px; margin-bottom: 15px; }
        .date-tab { flex: 0 0 auto; padding: 8px 15px; background: #fff; border: 2px solid #eee; border-radius: 20px; font-size: 0.9rem; color: #888; cursor: pointer; text-align: center; transition: 0.3s; }
        .date-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); transform: scale(1.05); box-shadow: 0 4px 10px rgba(74, 163, 223, 0.3); }

        /* è¡Œç¨‹é …ç›® */
        .timeline-item { border-left: 4px solid var(--primary-color); padding-left: 20px; margin-left: 10px; margin-bottom: 25px; position: relative; }
        .timeline-item::before { 
            content: 'â˜…'; position: absolute; left: -11px; top: 0; color: var(--accent-color); background: #fff; 
            border-radius: 50%; width: 22px; height: 22px; text-align: center; line-height: 24px; border: 2px solid var(--bg-color);
        }
        /* æ·ºè—è‰²è¡Œç¨‹åº•æ¡† */
        .timeline-header-box { 
            background: #E1F5FE; padding: 12px 15px; border-radius: 15px; margin-bottom: 10px; 
            display: inline-block; width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 5px solid var(--primary-dark);
        }
        .detail-card { background: #fff; border: 1px solid #f0f0f0; border-radius: 15px; padding: 15px; margin-top: 8px; font-size: 0.95rem; }
        .detail-row { display: flex; gap: 10px; margin-bottom: 8px; align-items: flex-start; }
        .detail-icon { color: var(--primary-color); font-weight: bold; min-width: 24px; text-align: center;}
        
        /* åå¸é€šçŸ¥ */
        #toast-container { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); z-index: 2000; pointer-events: none; }
        .toast { background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 30px; margin-top: 10px; animation: slideUp 0.3s; backdrop-filter: blur(5px); }

        /* å…¶ä»–é€šç”¨æ¨£å¼ */
        .trans-box { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-bottom: 10px; }
        #mrt-container { overflow: auto; border: 4px solid var(--primary-color); border-radius: 20px; height: 60vh; background: white; position: relative; -webkit-overflow-scrolling: touch; }
        .zoom-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; margin-top: 5px;}
        .zoom-btn { width: 50px; height: 50px; border-radius: 50%; background: var(--primary-color); color: white; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: 2px solid #fff; padding: 0; transition: 0.2s; }
        .zoom-btn:active { transform: scale(0.9); }
        .zoom-btn.reset { background: #607D8B; font-size: 0.85rem; font-weight: bold; }
        
        .shopping-item { display: flex; align-items: flex-start; padding: 15px 10px; border-bottom: 1px dashed #ddd; transition: background 0.2s; }
        .shopping-item.checked { opacity: 0.5; text-decoration: line-through; filter: grayscale(1); }
        .check-circle { width: 26px; height: 26px; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; cursor: pointer; background: white; flex-shrink: 0; margin-top: 3px; transition: all 0.3s; }
        .checked .check-circle { background: #4CAF50; border-color: #4CAF50; color: white; transform: scale(1.1); }
        .shopping-cat { display: inline-block; background: #E1F5FE; color: var(--primary-color); padding: 3px 8px; border-radius: 8px; font-size: 0.75rem; margin-bottom: 5px; font-weight: bold; }
        
        .ticket-card { border: 2px dashed var(--primary-color); background: #f4fbff; border-radius: 20px; padding: 20px; margin-bottom: 15px; position: relative; }
        .ticket-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; }
        .ticket-title { font-size: 1.15rem; font-weight: bold; color: var(--primary-color); }
        .ticket-info-row { display: flex; margin-bottom: 6px; align-items: baseline; }
        .ticket-info-label { width: 75px; color: #666; font-size: 0.9rem; font-weight: bold; }
        .ticket-info-value { flex: 1; }
        .ticket-price-tag { background: var(--accent-color); color: #5d4037; padding: 3px 10px; border-radius: 12px; font-weight: bold; font-size: 0.85rem; margin-right: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* æ€¥é›£æ•‘åŠ© */
        .emergency-section h4 { color: #D84315; border-bottom: 2px solid #FFAB91; display: inline-block; margin-top: 15px; margin-bottom: 5px;}
        .emergency-section p { margin: 5px 0; line-height: 1.5; }
        
        /* äº’å‹•å…ƒä»¶ */
        details { margin-bottom: 10px; background: white; border-radius: 12px; border: 1px solid #eee; overflow: hidden; }
        summary { padding: 12px 15px; cursor: pointer; font-weight: bold; background: #fcfcfc; list-style: none; display: flex; justify-content: space-between; }
        .details-content { padding: 15px; border-top: 1px solid #eee; }
        .transfer-box { background: #37474F; color: #eceff1; padding: 20px; border-radius: 20px; margin-top: 20px; }
        .transfer-box textarea { background: #263238; color: #69F0AE; border: 1px solid #546E7A; font-family: monospace; font-size: 0.85rem; height: 60px; }
        .auto-link { color: var(--primary-color); text-decoration: none; border-bottom: 1px dotted; font-weight: bold; }
        .auto-img { max-width: 100%; border-radius: 10px; margin-top: 8px; border: 1px solid #eee; display: block; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .file-upload-btn { background: #f0f0f0; color: #333; font-size: 0.8rem; padding: 5px 10px; border: 1px dashed #999; width: auto; margin-top: 5px; display: inline-block; cursor: pointer; text-align: center; }
    </style>
</head>
<body>

<!-- ğŸŒŸ è±ªè¯éå ´å‹•ç•« -->
<div id="splash-screen">
    <!-- é£›æ©Ÿç‰¹æ•ˆ -->
    <img src="airplane1.png" alt="Plane" class="splash-plane" onerror="this.style.display='none'">
    <!-- ä¸­å¤®å¤§åœ–ç¤º -->
    <img src="icon.png" alt="Icon" class="splash-icon" onerror="this.src='TH flag.png'">
    <h1 style="color:#0277BD; text-shadow:none;">2026 å®¸å®¸æ˜Ÿæ˜Ÿ<br>æ›¼è°·å¤§å†’éšª</h1>
    <!-- è¼‰å…¥é»é» -->
    <div class="loading-dots"><span></span><span></span><span></span></div>
    <!-- é–‹å§‹æŒ‰éˆ• -->
    <button id="start-btn" onclick="startApp()">ğŸš€ å‡ºç™¼ï¼</button>
</div>

<!-- éŸ³æ•ˆå…ƒä»¶ -->
<audio id="audio-opening"></audio>
<audio id="audio-bgm" loop></audio>
<!-- é»æ“Šèˆ‡é é¢éŸ³æ•ˆ (å…±ç”¨) -->
<audio id="audio-click"></audio>
<audio id="audio-page-effect"></audio>

<div id="toast-container"></div>

<header>
    <h1><span><img src="elephant.png" class="header-icon" alt="Elephant"></span> 2026 å®¸å®¸æ˜Ÿæ˜Ÿæ›¼è°·å¤§å†’éšª <img src="TH flag.png" class="header-icon" alt="Thai Flag"></h1>
</header>

<div class="container">
    <div id="page-flights" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('flights')" id="btn-edit-flights">âœï¸ ç·¨è¼¯</button></div>
            <div id="view-flights"></div>
            <div id="edit-flights" style="display:none;">
                <h3 class="section-title">âœˆï¸ å»ç¨‹ (Outbound)</h3><div id="edit-flights-outbound"></div>
                <h3 class="section-title">âœˆï¸ å›ç¨‹ (Inbound)</h3><div id="edit-flights-inbound"></div>
                <button onclick="saveData('flights')" class="full-width">ğŸ’¾ å„²å­˜èˆªç­è³‡æ–™</button>
            </div>
        </div>
    </div>
    
    <div id="page-hotel" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('hotel')" id="btn-edit-hotel">âœï¸ ç·¨è¼¯</button></div>
            <div id="view-hotel"></div>
            <div id="edit-hotel" style="display:none;">
                <div id="hotel-form-container"></div>
                <button class="secondary full-width" onclick="addHotel()">+ æ–°å¢é£¯åº—</button>
                <button onclick="saveData('hotel')" class="full-width">ğŸ’¾ å„²å­˜æ‰€æœ‰é£¯åº—</button>
            </div>
        </div>
    </div>
    
    <div id="page-itinerary" class="page active">
        <div class="edit-controls"><button onclick="toggleEdit('itinerary')" id="btn-edit-itinerary">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
        <div id="itinerary-tabs" class="date-tabs-container"></div>
        <div id="view-itinerary"></div>
        <div id="edit-itinerary" style="display:none;">
            <div id="itinerary-form-container"></div>
            <button class="secondary full-width" onclick="addDay()">+ æ–°å¢ä¸€å¤©</button>
            <button onclick="saveData('itinerary')" class="full-width">ğŸ’¾ å…¨éƒ¨å„²å­˜</button>
        </div>
    </div>
    
    <div id="page-mrt" class="page">
        <div class="card">
            <h3>ğŸš‡ æ›¼è°·æ·é‹åœ–</h3>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomMap(-25)">ï¼</button>
                <button class="zoom-btn reset" onclick="zoomMap(0)">é‡ç½®</button>
                <button class="zoom-btn" onclick="zoomMap(25)">ï¼‹</button>
            </div>
            <p style="color:#666; font-size:0.8rem; text-align:center; margin-bottom:5px;">ğŸ’¡ æ”¾å¤§å¾Œå¯æ»‘å‹•æŸ¥çœ‹</p>
            <div id="mrt-container">
                <img id="mrt-img" src="bangkok_mrt_2025.png" alt="Bangkok MRT" style="width: 100%; min-width: 100%; transition: width 0.3s ease;" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Bangkok_Mass_Transit_Network_Map.png/1024px-Bangkok_Mass_Transit_Network_Map.png';this.alt='æœ¬åœ°åœ–ç‰‡æœªæ‰¾åˆ°'">
            </div>
        </div>
    </div>
    
    <!-- ç¥¨åˆ¸é é¢ -->
    <div id="page-tickets" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('tickets')" id="btn-edit-tickets">âœï¸ ç·¨è¼¯</button></div>
            <div id="view-tickets"></div>
            <div id="edit-tickets" style="display:none;">
                <div id="tickets-form"></div>
                <button class="secondary full-width" onclick="addTicket()">+ æ–°å¢ç¥¨åˆ¸</button>
                <button onclick="saveData('tickets')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>

    <div id="page-translate" class="page">
        <div class="card">
            <h3>ğŸ‡¹ğŸ‡­ ç¿»è­¯å°å¹«æ‰‹</h3>
            <div class="trans-box"><label>ä¸­æ–‡ (ZH)</label><textarea id="trans-input" placeholder="è¼¸å…¥ä¸­æ–‡..."></textarea><button class="outline" onclick="speak('zh-TW', 'trans-input')">ğŸ”Š æ’­æ”¾ä¸­æ–‡</button></div>
            <div style="text-align:center; margin: 15px 0;"><button class="icon-btn" style="width:auto; border-radius:25px;" onclick="mockTranslate()">â¬‡ï¸ è·³è½‰ Google ç¿»è­¯ â¬‡ï¸</button></div>
            <div class="trans-box" style="background:#E1F5FE;"><label>æ³°æ–‡ (TH)</label><textarea id="trans-output" placeholder="é»æ“ŠæŒ‰éˆ•ç¿»è­¯..."></textarea><button class="outline" onclick="speak('th-TH', 'trans-output')">ğŸ”Š æ’­æ”¾æ³°æ–‡</button></div>
        </div>
    </div>
    
    <div id="page-phrases" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('phrases')" id="btn-edit-phrases">âœï¸ ç®¡ç†</button></div>
            <div id="view-phrases"></div>
            <div id="edit-phrases" style="display:none;">
                <div id="phrases-form"></div>
                <button class="secondary full-width" onclick="addPhrase()">+ æ–°å¢å¥å‹</button>
                <button onclick="saveData('phrases')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div id="page-shopping" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('shopping')" id="btn-edit-shopping">âœï¸ ç·¨è¼¯æ¸…å–®</button></div>
            <div id="view-shopping"></div>
            <div id="edit-shopping" style="display:none;">
                <div id="shopping-form"></div>
                <button class="secondary full-width" onclick="addShoppingItem()">+ æ–°å¢å¿…è²·</button>
                <button onclick="saveData('shopping')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div id="page-notes" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('notes')" id="btn-edit-notes">âœï¸ å¯«ç­†è¨˜</button></div>
            <div id="view-notes"></div>
            <div id="edit-notes" style="display:none;">
                <div id="notes-form"></div>
                <button class="secondary full-width" onclick="addNote()">+ æ–°å¢ç­†è¨˜</button>
                <button onclick="saveData('notes')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div id="page-emergency" class="page">
        <div class="card emergency-section" style="border-left: 5px solid #FF7043;">
            <h3 style="color:#D84315;">ğŸ†˜ æ€¥é›£æ•‘åŠ©</h3>
            
            <h4>ã€Šå°ç£å¤–äº¤éƒ¨ã€‹</h4>
            <p>æ€¥é›£æ•‘åŠ©å°ˆç·šï¼ˆæµ·å¤–ç›´æ’¥ï¼‰ï¼š<a href="tel:080008509">0800-085-09</a></p>

            <h4>ã€Šé§æ³°åœ‹å°åŒ—ç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ã€‹</h4>
            <p>ç·Šæ€¥é›»è©±ï¼ˆéä¸Šç­æ™‚é–“ï¼‰ï¼š<a href="tel:+66816664006" style="color:red; font-weight:bold;">+66-81-6664006</a></p>
            <p>è¾¦å…¬å®¤é›»è©±ï¼ˆä¸Šç­æ™‚é–“ï¼‰ï¼š<a href="tel:+6621193555">+66-2-119-3555</a></p>
            <p>é›»å­éƒµä»¶ï¼š<a href="mailto:tha@mofa.gov.tw">tha@mofa.gov.tw</a></p>

            <h4>ã€Šæ³°åœ‹ç•¶åœ°ç·Šæ€¥é›»è©±ã€‹</h4>
            <p>è§€å…‰è­¦å¯Ÿï¼š1155 (ä¸­æ–‡æœå‹™)</p>
            <p>é†«ç™‚æ€¥æ•‘ä¸­å¿ƒï¼š1669 æˆ– 1554</p>
            <p>æ¶ˆè²»è€…ä¿è­·è¾¦å…¬å®¤ï¼š1166</p>
            <p style="background:#FFF3E0; padding:10px; font-size:0.85rem; border-radius:10px; margin-top:10px;">
                æ€¥é›£æ•‘åŠ©å°ˆç·šåƒ…é™ç·Šæ€¥æƒ…æ³ï¼ˆè»Šç¦ã€æ¶åŠ«ã€ç”Ÿå‘½å®‰å±ï¼‰ã€‚<br>
                ä¸€èˆ¬å•é¡Œè«‹æ–¼ä¸Šç­æ™‚é–“è¯ç¹«è¾¦äº‹è™•ã€‚
            </p>

            <h4>ã€ŠLINEå¸³è™Ÿã€‹</h4>
            <p>ä¿å¹³å®‰æœå‹™å°ˆç·š LINE ID: <strong>@Taiwan119</strong></p>
        </div>

        <!-- æª”æ¡ˆå‚™ä»½ -->
        <div class="card transfer-box">
            <h3 style="color:#fff;">ğŸ”„ JSON å‚™ä»½èˆ‡é‚„åŸ</h3>
            <div style="font-size:0.9rem; color:#ddd; margin-bottom:10px;">
                å°‡è³‡æ–™å­˜æˆæª”æ¡ˆï¼Œæˆ–å¾æª”æ¡ˆé‚„åŸè³‡æ–™ã€‚
            </div>
            <div style="display:flex; gap:10px;">
                <button class="secondary" onclick="exportJSON()" style="flex:1;">ğŸ“¤ åŒ¯å‡ºå‚™ä»½æª”</button>
                <button class="success" onclick="document.getElementById('import-file').click()" style="flex:1;">ğŸ“¥ åŒ¯å…¥å‚™ä»½æª”</button>
            </div>
            <input type="file" id="import-file" style="display: none;" accept=".json" onchange="handleFileImport(this)">
        </div>

        <div style="text-align:center; margin-top:20px;"><button onclick="resetApp()" class="danger" style="opacity:0.6;">âš ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button></div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item" onclick="switchPage('flights', this)" data-page="flights"><img src="airplane.png" class="nav-icon-img"><span>èˆªç­</span></div>
    <div class="nav-item" onclick="switchPage('hotel', this)" data-page="hotel"><img src="hotel.png" class="nav-icon-img"><span>é£¯åº—</span></div>
    <div class="nav-item active" onclick="switchPage('itinerary', this)" data-page="itinerary"><img src="liti.png" class="nav-icon-img"><span>è¡Œç¨‹</span></div>
    <div class="nav-item" onclick="switchPage('mrt', this)" data-page="mrt"><img src="train.png" class="nav-icon-img"><span>æ·é‹</span></div>
    <!-- ç¥¨åˆ¸æŒ‰éˆ• (é è¨­Base64åœ–ç¤ºé˜²æ­¢ç ´åœ–) -->
    <div class="nav-item" onclick="switchPage('tickets', this)" data-page="tickets"><img src="ticket.png" class="nav-icon-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODg4IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTIgOWE1IDUgMCAwIDAgMTAgMHY2YTUgNSAwIDAgMCAxMCAwdi02YTUgNSAwIDAgMC0xMCAwVjJINnY3eiIvPjwvc3ZnPg=='"><span>ç¥¨åˆ¸</span></div>
    <div class="nav-item" onclick="switchPage('translate', this)" data-page="translate"><img src="man.png" class="nav-icon-img"><span>ç¿»è­¯</span></div>
    <div class="nav-item" onclick="switchPage('phrases', this)" data-page="phrases"><img src="TH flag.png" class="nav-icon-img"><span>æ³°æ–‡</span></div>
    <div class="nav-item" onclick="switchPage('shopping', this)" data-page="shopping"><img src="shoppingbag.png" class="nav-icon-img"><span>å¿…è²·</span></div>
    <div class="nav-item" onclick="switchPage('notes', this)" data-page="notes"><img src="note.png" class="nav-icon-img"><span>ç­†è¨˜</span></div>
    <div class="nav-item" onclick="switchPage('emergency', this)" data-page="emergency"><img src="SOS.png" class="nav-icon-img"><span>æ±‚åŠ©</span></div>
</nav>

<script>
    const STORAGE_KEY = 'TravelApp_2026_V20_Fixed'; 
    
    // --- éŸ³æ•ˆæª”æ¡ˆè¨­å®š (è«‹ç¢ºèªæª”æ¡ˆå·²æ”¾å…¥è³‡æ–™å¤¾) ---
    const AUDIO_FILES = {
        opening: 'opening.mp3', // é–‹å ´éŸ³æ•ˆ
        bgm: 'bgm.mp3',         // èƒŒæ™¯éŸ³æ¨‚
        click: 'click.mp3',     // é è¨­é»æ“ŠéŸ³æ•ˆ
        // å„é é¢å°ˆå±¬åˆ‡æ›éŸ³æ•ˆ
        pages: {
            'flights': 'flights.mp3',
            'hotel': 'hotel.mp3',
            'itinerary': 'itinerary.mp3',
            'mrt': 'mrt.mp3',
            'tickets': 'tickets.mp3',
            'translate': 'translate.mp3',
            'phrases': 'phrases.mp3',
            'shopping': 'shopping.mp3',
            'notes': 'notes.mp3',
            'emergency': 'emergency.mp3'
        }
    };

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW Fail', err));
        });
    }

    const defaultPhrases = [
        {zh:"ä½ å¥½", th:"Sawasdee (krub/ka)"}, {zh:"è¬è¬", th:"Khop khun (krub/ka)"}, {zh:"å°ä¸èµ·", th:"Kor tot"}, {zh:"æ²’é—œä¿‚", th:"Mai pen rai"},
        {zh:"æ˜¯çš„", th:"Chai"}, {zh:"ä¸æ˜¯", th:"Mai chai"}, {zh:"å¤šå°‘éŒ¢?", th:"Tao rai?"}, {zh:"å¤ªè²´äº†", th:"Paeng pai"},
        {zh:"ä¾¿å®œä¸€é»", th:"Lot noi dai mai?"}, {zh:"æˆ‘æƒ³è¦é€™å€‹", th:"Ao an nee"}, {zh:"ä¸è¦", th:"Mai ao"}, {zh:"æœ‰...å—?", th:"Mee ... mai?"},
        {zh:"å»æ‰€åœ¨å“ª?", th:"Hong nam yoo tee nai?"}, {zh:"ç›´èµ°", th:"Dtrohng bpai"}, {zh:"å·¦è½‰", th:"Liao sai"}, {zh:"å³è½‰", th:"Liao kwa"},
        {zh:"æ•‘å‘½", th:"Chuay duay"}, {zh:"é†«é™¢", th:"Rong payaban"}, {zh:"è­¦å¯Ÿ", th:"Dtam ruat"}, {zh:"æˆ‘è¿·è·¯äº†", th:"Chan long tang"},
        {zh:"å¥½", th:"Dee"}, {zh:"å¥½åƒ", th:"Aroy"}, {zh:"ä¸è¾£", th:"Mai phet"}, {zh:"ä¸€é»é»è¾£", th:"Phet nit noi"},
        {zh:"ä¸è¦é¦™èœ", th:"Mai sai pak chee"}, {zh:"è²·å–®", th:"Check bin / Gep tang"}, {zh:"æ°´", th:"Nam"}, {zh:"å†°å¡Š", th:"Nam kaeng"},
        {zh:"ç†±", th:"Ron"}, {zh:"å†·", th:"Nao/Yen"}, {zh:"èˆ’æœ", th:"Sabai"}, {zh:"æ¼‚äº®", th:"Suay"}, {zh:"å¯æ„›", th:"Narak"},
        {zh:"å¹¾é»?", th:"Gee mong?"}, {zh:"ä»€éº¼?", th:"Arai na?"}, {zh:"ä¸æ‡‚/ä¸æ˜ç™½", th:"Mai kao jai"}, {zh:"å¯ä»¥æ‹ç…§å—?", th:"Tai roop dai mai?"},
        {zh:"æ©Ÿå ´", th:"Sanam bin"}, {zh:"é£¯åº—", th:"Rong raem"}, {zh:"è¨ˆç¨‹è»Š", th:"Taxi"}, {zh:"åœåœ¨é€™è£¡", th:"Jort tee nee"},
        {zh:"å»...", th:"Bpai ..."}, {zh:"é€™è£¡", th:"Tee nee"}, {zh:"é‚£è£¡", th:"Tee nan"}, {zh:"ç¾åœ¨", th:"Dton nee"},
        {zh:"ä»Šå¤©", th:"Wan nee"}, {zh:"æ˜å¤©", th:"Prung nee"}, {zh:"æ˜¨å¤©", th:"Meua wan"}, {zh:"ç”·äºº", th:"Poo chai"}, {zh:"å¥³äºº", th:"Poo ying"}
    ];

    const defaultData = {
        flights: { 
            outbound: { airline: 'æ˜Ÿå®‡èˆªç©º', origin: 'å°åŒ— (TPE)', terminal: 'ç¬¬ä¸€èˆªå»ˆ', number: 'JX741', date: '2026-02-10', time: '10:00', boardingTime: '09:30', gate: 'B5', pnr: 'AB1234', price: '12000', notes: '', passengers: [{name:'å®¸å®¸', seat:'12A'}, {name:'æ˜Ÿæ˜Ÿ', seat:'12B'}] }, 
            inbound: { airline: 'æ˜Ÿå®‡èˆªç©º', origin: 'æ›¼è°· (BKK)', terminal: '-', number: 'JX742', date: '2026-02-15', time: '14:00', boardingTime: '13:30', gate: 'D2', pnr: 'AB1234', price: '12000', notes: '', passengers: [{name:'å®¸å®¸', seat:'15C'}, {name:'æ˜Ÿæ˜Ÿ', seat:'15D'}] } 
        },
        hotels: [{ name: 'The Standard, Bangkok', address: '114 Narathiwas Road', transport:'BTS Chong Nonsi', checkin:'2026-02-10', checkout:'2026-02-13', voucher:'', photo:'', surroundings:'è¿‘æœ€é«˜æ¨“è§€æ™¯å°', notes: 'è¨˜å¾—è¦é«˜æ¨“å±¤' }],
        itinerary: [{ date: '2026-02-10', summary: 'æŠµé”æ›¼è°·', items: [{ time:'14:00', title:'é£¯åº— Check-in', desc:'è¾¦ç†å…¥ä½æ‰‹çºŒ', transport:'æ©Ÿå ´å¿«ç·š', mapUrl:'', hours:'24H', mustBuy:'', menu:'', voucher:'', photo:'', notes:'' }] }],
        tickets: [], 
        phrases: defaultPhrases,
        shopping: [{ category:'é£²æ–™', item:'æ‰‹æ¨™å¥¶èŒ¶', price:'140', location:'Big C', image:'', notes:'åŠç³–å‰›å¥½', done: false }],
        notes: [{ date: 'æé†’', content: 'è¨ˆç¨‹è»Šè¦è¨˜å¾—å–Š By Meter (è·³è¡¨)ï¼' }]
    };

    let appData;
    try {
        const stored = localStorage.getItem(STORAGE_KEY);
        appData = stored ? JSON.parse(stored) : defaultData;
    } catch(e) { appData = defaultData; }

    // è³‡æ–™ä¿®å¾©
    if(!appData.flights) appData.flights = defaultData.flights;
    if(!Array.isArray(appData.hotels)) appData.hotels = defaultData.hotels;
    if(!Array.isArray(appData.itinerary)) appData.itinerary = defaultData.itinerary;
    if(!Array.isArray(appData.tickets)) appData.tickets = []; 
    if(!Array.isArray(appData.phrases)) appData.phrases = defaultPhrases;
    if(!Array.isArray(appData.shopping)) appData.shopping = defaultData.shopping;
    if(!Array.isArray(appData.notes)) appData.notes = defaultData.notes;

    appData.shopping.forEach(s => { if(s.image === undefined) s.image = ''; if(s.category === undefined) s.category = ''; if(s.notes === undefined) s.notes = ''; });
    appData.itinerary.forEach(day => { if(!day.items) day.items = []; day.items.forEach(item => { if(item.photo === undefined) item.photo = ''; }); });
    
    localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
    let currentItineraryDayIndex = 0;

    function saveToLocal() { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); } catch(e) { showToast('âš ï¸ å„²å­˜å¤±æ•—ï¼æª”æ¡ˆå¯èƒ½éå¤§ã€‚'); } }
    function saveData(section) { saveToLocal(); showToast('âœ¨ å„²å­˜æˆåŠŸï¼'); toggleEdit(section); if(section==='itinerary') renderView('itinerary');}
    function saveImage(section) { saveToLocal(); showToast('åœ–ç‰‡ä¸Šå‚³æˆåŠŸï¼'); }
    function showToast(msg) {
        const c = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = 'toast'; t.innerText = msg;
        c.appendChild(t);
        setTimeout(() => { t.style.opacity='0'; setTimeout(()=>t.remove(),500); }, 2000);
    }
    function resetApp() { if(confirm("âš ï¸ ç¢ºå®šé‡ç½®ï¼Ÿ")) { localStorage.removeItem(STORAGE_KEY); location.reload(); } }

    // --- éŸ³æ•ˆé‚è¼¯ ---
    function initAudio() {
        const audioOpening = document.getElementById('audio-opening');
        const audioBGM = document.getElementById('audio-bgm');
        const audioClick = document.getElementById('audio-click');
        const audioPage = document.getElementById('audio-page-effect');

        audioOpening.src = AUDIO_FILES.opening;
        audioBGM.src = AUDIO_FILES.bgm;
        audioClick.src = AUDIO_FILES.click;
        audioBGM.volume = 0.3;

        document.addEventListener('click', (e) => {
            if (e.target.id === 'start-btn') return;
            if (e.target.closest('button.outline') || e.target.classList.contains('outline')) return;

            const navItem = e.target.closest('.nav-item');
            if (navItem) {
                const pageId = navItem.getAttribute('data-page');
                const soundFile = AUDIO_FILES.pages[pageId];
                if(soundFile) {
                    audioPage.src = soundFile;
                    audioPage.play().catch(()=>{});
                } else {
                    const clone = audioClick.cloneNode();
                    clone.volume = 0.5; clone.play().catch(()=>{});
                }
            }
        });
    }

    function startApp() {
        const screen = document.getElementById('splash-screen');
        screen.style.opacity = '0';
        setTimeout(() => screen.style.display = 'none', 800);
        
        const openAudio = document.getElementById('audio-opening');
        if(openAudio.src && openAudio.paused) openAudio.play().catch(e=>{});

        const bgm = document.getElementById('audio-bgm');
        if(bgm.src) bgm.play().catch(e=>{});
    }

    function switchPage(pageId, navEl) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navEl.classList.add('active');
        renderView(pageId);
    }
    
    function toggleEdit(section) {
        const v = document.getElementById(`view-${section}`);
        const e = document.getElementById(`edit-${section}`);
        const btn = document.getElementById(`btn-edit-${section}`);
        if (e.style.display === 'none') { e.style.display = 'block'; v.style.display = 'none'; btn.innerText = 'ğŸ‘€ è¿”å›æª¢è¦–'; } 
        else { e.style.display = 'none'; v.style.display = 'block'; btn.innerText = 'âœï¸ ç·¨è¼¯'; }
        renderView(section);
    }

    function switchItineraryDay(index) { currentItineraryDayIndex = index; renderView('itinerary'); }
    function formatContent(text) {
        if (!text) return '';
        const str = String(text); 
        if (str.startsWith('data:image')) return `<img src="${str}" class="auto-img" alt="åœ–ç‰‡"><br><small>æœ¬åœ°åœ–ç‰‡</small>`;
        if (str.match(/\.(jpeg|jpg|gif|png|webp)(\?.*)?$/i) && str.startsWith('http')) return `<a href="${str}" target="_blank"><img src="${str}" class="auto-img" alt="åœ–ç‰‡"></a>`;
        const urlRegex = /(https?:\/\/[^\s]+)/g;
        return str.replace(urlRegex, (url) => `<a href="${url}" target="_blank" class="auto-link">ğŸ”— é–‹å•Ÿé€£çµ</a>`);
    }

    function compressImage(file, callback) {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function(event) {
            const img = new Image();
            img.src = event.target.result;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const maxWidth = 600; 
                const scaleSize = maxWidth / img.width;
                canvas.width = maxWidth;
                canvas.height = img.height * scaleSize;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                const dataUrl = canvas.toDataURL('image/jpeg', 0.6); 
                callback(dataUrl);
            }
        }
    }

    // --- JSON å‚™ä»½ ---
    function exportJSON() {
        const dataStr = JSON.stringify(appData, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `bangkok_backup_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    function handleFileImport(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const newData = JSON.parse(e.target.result);
                if (newData.flights) {
                    appData = newData;
                    // è³‡æ–™ä¿®è£œ
                    if(!appData.tickets) appData.tickets = [];
                    saveToLocal();
                    showToast("é‚„åŸæˆåŠŸï¼é‡æ•´ä¸­...");
                    setTimeout(() => location.reload(), 1500);
                } else { alert("âŒ æ ¼å¼éŒ¯èª¤"); }
            } catch (error) { alert("âŒ è®€å–å¤±æ•—"); }
        };
        reader.readAsText(file);
        input.value = ''; 
    }

    function renderView(section) { try { if(renderers[section]) renderers[section](); } catch(e) { console.error(e); } }

    const renderers = {
        flights: () => {
            const flightFields = { airline: 'èˆªç©ºå…¬å¸', origin:'å‡ºç™¼åœ°é»', terminal:'èˆªå»ˆ', number: 'èˆªç­è™Ÿç¢¼', date: 'èˆªç­æ—¥æœŸ', time: 'å‡ºç™¼/åˆ°é”æ™‚é–“', boardingTime:'ç™»æ©Ÿæ™‚é–“', gate: 'ç™»æ©Ÿé–€', pnr: 'è¨‚ä½ä»£ç¢¼', price:'ç¥¨åƒ¹', notes:'å‚™è¨»' };
            const genView = (t, d) => {
                let h = `<h3 class="section-title">${t}</h3>`;
                for (let k in flightFields) h += `<div class="info-row"><span class="info-label">${flightFields[k]}</span><span class="info-value">${formatContent(d[k] || '-')}</span></div>`;
                h += `<div class="info-row"><span class="info-label">æ—…å®¢/åº§ä½</span><span class="info-value">` + (d.passengers || []).map(p => `${p.name} (${p.seat})`).join(', ') + `</span></div>`;
                return h;
            };
            document.getElementById('view-flights').innerHTML = genView('âœˆï¸ å»ç¨‹', appData.flights.outbound) + '<br>' + genView('âœˆï¸ å›ç¨‹', appData.flights.inbound);
            const genEdit = (type, data) => {
                let html = '';
                for (let k in flightFields) {
                    html += `<label>${flightFields[k]}</label>`;
                    if(k==='notes') html += `<textarea onchange="appData.flights.${type}.${k}=this.value">${data[k]||''}</textarea>`;
                    else html += `<input value="${data[k]||''}" onchange="appData.flights.${type}.${k}=this.value">`;
                }
                html += `<label>æ—…å®¢ (å¯æ–°å¢)</label><div id="passengers-${type}">`;
                (data.passengers || []).forEach((p, idx) => {
                    html += `<div style="display:flex; gap:5px;"><input placeholder="å§“å" value="${p.name}" onchange="appData.flights.${type}.passengers[${idx}].name=this.value"><input placeholder="åº§ä½" value="${p.seat}" onchange="appData.flights.${type}.passengers[${idx}].seat=this.value"><button class="danger icon-btn" onclick="removePax('${type}', ${idx})">ğŸ—‘ï¸</button></div>`;
                });
                html += `</div><button class="secondary outline full-width" onclick="addPax('${type}')">â• æ–°å¢æ—…å®¢</button>`;
                return html;
            };
            document.getElementById('edit-flights-outbound').innerHTML = genEdit('outbound', appData.flights.outbound);
            document.getElementById('edit-flights-inbound').innerHTML = genEdit('inbound', appData.flights.inbound);
        },
        hotel: () => {
            document.getElementById('view-hotel').innerHTML = appData.hotels.map((h, i) => `
                <div style="border-bottom:3px solid var(--accent-color); padding-bottom:15px; margin-bottom:15px;">
                    <h3 style="color:var(--primary-color);">ğŸ¨ ${i+1}. ${h.name}</h3>
                    <div class="info-row"><span class="info-label">åœ°å€</span><span class="info-value">${h.address}</span></div>
                    <div class="info-row"><span class="info-label">äº¤é€š</span><span class="info-value">${h.transport}</span></div>
                    <div class="info-row"><span class="info-label">æ—¥æœŸ</span><span class="info-value">${h.checkin} ~ ${h.checkout}</span></div>
                    <div class="info-row"><span class="info-label">æ†‘è­‰</span><span class="info-value">${formatContent(h.voucher)}</span></div>
                    ${h.photo ? `<div class="info-row"><span class="info-label">ç…§ç‰‡</span><span class="info-value">${formatContent(h.photo)}</span></div>` : ''}
                    <div class="detail-card" style="background:#FFF9C4;"><div><b>é€±é‚Šç’°å¢ƒï¼š</b>${h.surroundings}</div><div style="margin-top:5px;"><b>å‚™è¨»ï¼š</b>${h.notes}</div></div>
                </div>`).join('');
            const fields = { name:'é£¯åº—åç¨±', address:'åœ°å€', transport:'äº¤é€šæ–¹å¼', checkin:'å…¥ä½ (YYYY-MM-DD)', checkout:'é€€æˆ¿', voucher:'å…¥ä½æ†‘è­‰', photo:'ç…§ç‰‡é€£çµ', surroundings:'é€±é‚Šç’°å¢ƒ', notes:'å‚™è¨»' };
            document.getElementById('hotel-form-container').innerHTML = appData.hotels.map((h, idx) => `
                <div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeHotel(${idx})">ğŸ—‘ï¸</button><h4 style="margin-top:0;">é£¯åº— ${idx+1}</h4>${Object.entries(fields).map(([k, label]) => `<label>${label}</label>${(k.includes('notes')||k.includes('surr')) ? `<textarea onchange="appData.hotels[${idx}].${k}=this.value">${h[k]}</textarea>` : `<input value="${h[k]}" onchange="appData.hotels[${idx}].${k}=this.value">`}`).join('')}</div>`).join('');
        },
        itinerary: () => {
            document.getElementById('itinerary-tabs').innerHTML = appData.itinerary.map((d, i) => 
                `<div class="date-tab ${i===currentItineraryDayIndex?'active':''}" onclick="switchItineraryDay(${i})">Day ${i+1}<br><span style="font-size:0.7rem">${d.date}</span></div>`
            ).join('');
            const day = appData.itinerary[currentItineraryDayIndex];
            if(day) {
                const mapLink = (i) => i.mapUrl ? `<a href="${i.mapUrl}" target="_blank">ğŸ“ åœ°åœ–</a>` : (i.title ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i.title + ' Bangkok')}" target="_blank">ğŸ” æœåœ°åœ–</a>` : '');
                document.getElementById('view-itinerary').innerHTML = `
                    <div class="timeline-header-box" style="text-align:center;color:#0277BD;">ğŸ“…${day.summary || 'æœªè¨­å®š'}</div>
                    ${day.items.map(i => `
                    <div class="timeline-item">
                        <div class="timeline-header-box"><div style="font-weight:bold; color:var(--primary-color); font-size:1.1rem;">${i.time} ${i.title}</div><div style="color:#555; font-size:0.9rem;">${i.desc || ''}</div></div>
                        <div class="detail-card">
                            ${i.transport?`<div class="detail-row"><span class="detail-icon">ğŸšŒ</span> ${i.transport}</div>`:''}
                            ${mapLink(i)?`<div class="detail-row"><span class="detail-icon">ğŸ—ºï¸</span> ${mapLink(i)}</div>`:''}
                            ${i.hours?`<div class="detail-row"><span class="detail-icon">ğŸ•’</span> ${i.hours}</div>`:''}
                            ${i.mustBuy?`<div class="detail-row"><span class="detail-icon">ğŸ›ï¸</span> å¿…è²·: ${i.mustBuy}</div>`:''}
                            ${i.menu?`<div class="detail-row"><span class="detail-icon">ğŸ´</span> æ¨è–¦: ${i.menu}</div>`:''}
                            ${i.voucher?`<div class="detail-row"><span class="detail-icon">ğŸ«</span> æ†‘è­‰: ${formatContent(i.voucher)}</div>`:''}
                            ${i.photo?`<div class="detail-row"><span class="detail-icon">ğŸ“·</span> ç…§ç‰‡: ${formatContent(i.photo)}</div>`:''}
                            ${i.notes?`<div class="detail-row"><span class="detail-icon">ğŸ“</span> å‚™è¨»: ${formatContent(i.notes)}</div>`:''}
                        </div>
                    </div>`).join('')}`;
            } else { document.getElementById('view-itinerary').innerHTML = '<div style="text-align:center;padding:20px;">å°šç„¡è¡Œç¨‹</div>'; }

            const itemFields = { time:'æ™‚é–“', title:'æ¨™é¡Œ', desc:'ç°¡è¿°', transport:'äº¤é€š', mapUrl:'Googleåœ°åœ–é€£çµ', hours:'ç‡Ÿæ¥­æ™‚é–“', mustBuy:'å¿…è²·', menu:'æ¨è–¦èœå–®', voucher:'æ†‘è­‰', photo:'ç…§ç‰‡', notes:'å‚™è¨»' };
            document.getElementById('itinerary-form-container').innerHTML = appData.itinerary.map((d, dIdx) => `
                <div class="edit-group" style="border:2px solid var(--accent-color);"><button class="icon-btn delete-btn-corner danger" onclick="removeDay(${dIdx})">ğŸ—‘ï¸</button><label>Day ${dIdx+1} æ—¥æœŸ</label><input type="date" value="${d.date}" onchange="appData.itinerary[${dIdx}].date=this.value"><label>ç•¶æ—¥ä¸»é¡Œ</label><input value="${d.summary}" onchange="appData.itinerary[${dIdx}].summary=this.value"><hr style="margin:10px 0;"><label>è¡Œç¨‹é …ç›® (é»æ“Šå±•é–‹)</label><div id="day-${dIdx}-items">${d.items.map((item, iIdx) => `<details><summary>${item.time || 'æ™‚é–“'} - ${item.title || 'é …ç›®'} <span onclick="removeItm(${dIdx}, ${iIdx})" style="float:right; color:red;">ğŸ—‘ï¸</span></summary><div class="details-content">${Object.entries(itemFields).map(([k, label]) => {if(k==='photo'){return `<label>${label}</label><input placeholder="è²¼ä¸Šç¶²å€" value="${item[k]||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].${k}=this.value" id="it-img-${dIdx}-${iIdx}"><label class="file-upload-btn">ğŸ“ ä¸Šå‚³åœ–ç‰‡ (è‡ªå‹•å£“ç¸®)<input type="file" style="display:none;" accept="image/*" onchange="compressImage(this.files[0], (base64) => { appData.itinerary[${dIdx}].items[${iIdx}].photo = base64; document.getElementById('it-img-${dIdx}-${iIdx}').value = 'å·²è¼‰å…¥åœ–ç‰‡'; saveImage('itinerary'); })"></label>`;} return `<label>${label}</label><input value="${item[k]||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].${k}=this.value">`;}).join('')}</div></details>`).join('')}</div><button class="outline full-width" onclick="addItm(${dIdx})">â• æ–°å¢é …ç›®</button></div>`).join('');
        },
        tickets: () => {
            const ticketFields = { name:'ç¥¨åˆ¸åç¨±', date:'æ—¥æœŸ', time:'æ™‚é–“', priceAdult:'æˆäººåƒ¹æ ¼', priceChild:'å…’ç«¥åƒ¹æ ¼', location:'åœ°é»', image:'æ†‘è­‰åœ–ç‰‡', notes:'å‚™è¨»' };
            const list = appData.tickets || [];
            document.getElementById('view-tickets').innerHTML = list.length ? list.map(t => `
                <div class="ticket-card"><div class="ticket-header"><div class="ticket-title">${t.name || 'æœªå‘½å'}</div><div style="font-size:0.9rem; color:#666;">${t.date || ''} ${t.time || ''}</div></div><div class="ticket-info-row"><span class="ticket-info-label">åƒ¹æ ¼:</span><div class="ticket-info-value"><span class="ticket-price-tag">æˆäºº: ${t.priceAdult}</span> <span class="ticket-price-tag" style="background:#E0F2F1; color:#00695C;">å…’ç«¥: ${t.priceChild}</span></div></div><div class="ticket-info-row"><span class="ticket-info-label">åœ°é»:</span><div class="ticket-info-value">${t.location || '-'}</div></div><div class="ticket-info-row"><span class="ticket-info-label">å‚™è¨»:</span><div class="ticket-info-value">${t.notes || '-'}</div></div>${t.image ? `<div style="margin-top:10px; border-top:1px dashed #ccc; padding-top:10px;"><b>æ†‘è­‰:</b><br>${formatContent(t.image)}</div>` : ''}</div>`).join('') : '<div style="text-align:center; padding:20px;">å°šç„¡ç¥¨åˆ¸è³‡æ–™</div>';
            document.getElementById('tickets-form').innerHTML = list.map((t, i) => `
                <div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('tickets', ${i})">ğŸ—‘ï¸</button>${Object.entries(ticketFields).map(([k, label]) => {if(k==='image'){return `<label>${label}</label><input placeholder="è²¼ä¸Šç¶²å€" value="${t[k]||''}" onchange="appData.tickets[${i}].${k}=this.value" id="ticket-img-${i}"><label class="file-upload-btn">ğŸ“ ä¸Šå‚³åœ–ç‰‡ (è‡ªå‹•å£“ç¸®)<input type="file" style="display:none;" accept="image/*" onchange="compressImage(this.files[0], (base64) => { appData.tickets[${i}].image = base64; document.getElementById('ticket-img-${i}').value = 'å·²è¼‰å…¥åœ–ç‰‡'; saveImage('tickets'); })"></label>`;} return `<label>${label}</label><input value="${t[k]||''}" onchange="appData.tickets[${i}].${k}=this.value">`;}).join('')}</div>`).join('');
        },
        phrases: () => {
            document.getElementById('view-phrases').innerHTML = appData.phrases.map(p => `<div class="card" style="padding:10px; display:flex; justify-content:space-between; align-items:center;"><div><div style="font-weight:bold;">${p.zh}</div><div style="color:var(--primary-color)">${p.th}</div></div><button class="icon-btn outline" onclick="speak('th-TH', null, '${p.th}')">ğŸ”Š</button></div>`).join('');
            document.getElementById('phrases-form').innerHTML = appData.phrases.map((p, i) => `<div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('phrases', ${i})">ğŸ—‘ï¸</button><input placeholder="ä¸­æ–‡" value="${p.zh}" onchange="appData.phrases[${i}].zh=this.value"><input placeholder="æ³°æ–‡" value="${p.th}" onchange="appData.phrases[${i}].th=this.value"></div>`).join('');
        },
        shopping: () => {
            document.getElementById('view-shopping').innerHTML = appData.shopping.map((s, i) => `
                <div class="shopping-item ${s.done ? 'checked' : ''}"><div class="check-circle" onclick="toggleShopCheck(${i})">${s.done ? 'âœ”' : ''}</div><div style="flex-grow:1;">${s.category?`<div class="shopping-cat">${s.category}</div>`:''}<b>${s.item}</b> <span style="font-size:0.8rem; background:#eee;">${s.location}</span>${s.image?`<div style="margin-top:5px;">${formatContent(s.image)}</div>`:''}${s.notes?`<div style="font-size:0.85rem; color:#666; margin-top:2px;">å‚™è¨»: ${s.notes}</div>`:''}</div><div style="font-weight:bold; color:var(--primary-color);">à¸¿${s.price}</div></div>`).join('');
            document.getElementById('shopping-form').innerHTML = appData.shopping.map((s, i) => `
                <div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('shopping', ${i})">ğŸ—‘ï¸</button><input placeholder="åˆ†é¡" value="${s.category||''}" onchange="appData.shopping[${i}].category=this.value"><input placeholder="å“é …" value="${s.item}" onchange="appData.shopping[${i}].item=this.value"><input placeholder="åƒ¹æ ¼" value="${s.price}" onchange="appData.shopping[${i}].price=this.value"><input placeholder="åœ°é»" value="${s.location}" onchange="appData.shopping[${i}].location=this.value"><input placeholder="å‚™è¨»" value="${s.notes||''}" onchange="appData.shopping[${i}].notes=this.value"><input placeholder="åœ–ç‰‡ç¶²å€" value="${s.image||''}" onchange="appData.shopping[${i}].image=this.value" id="shop-img-${i}"><label class="file-upload-btn">ğŸ“ ä¸Šå‚³åœ–ç‰‡ (è‡ªå‹•å£“ç¸®)<input type="file" style="display:none;" accept="image/*" onchange="compressImage(this.files[0], (base64) => { appData.shopping[${i}].image = base64; document.getElementById('shop-img-${i}').value = 'å·²è¼‰å…¥åœ–ç‰‡'; saveImage('shopping'); })"></label></div>`).join('');
        },
        notes: () => {
            document.getElementById('view-notes').innerHTML = appData.notes.map(n => `<div class="card" style="background:#FFF9C4; white-space:pre-wrap;"><b>${n.date}</b>\n${n.content}</div>`).join('');
            document.getElementById('notes-form').innerHTML = appData.notes.map((n, i) => `<div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('notes', ${i})">ğŸ—‘ï¸</button><input placeholder="æ¨™é¡Œ" value="${n.date}" onchange="appData.notes[${i}].date=this.value"><textarea placeholder="å…§å®¹" onchange="appData.notes[${i}].content=this.value">${n.content}</textarea></div>`).join('');
        }
    };

    function addPax(type) { appData.flights[type].passengers.push({name:'', seat:''}); renderView('flights'); }
    function removePax(type, idx) { appData.flights[type].passengers.splice(idx, 1); renderView('flights'); }
    function addHotel() { appData.hotels.push({name:'', address:'', transport:'', checkin:'', checkout:'', voucher:'', photo:'', surroundings:'', notes:''}); renderView('hotel'); }
    function removeHotel(idx) { if(confirm('åˆªé™¤æ­¤é£¯åº—ï¼Ÿ')) { appData.hotels.splice(idx, 1); renderView('hotel'); } }
    function addDay() { appData.itinerary.push({date:'', summary:'', items:[]}); renderView('itinerary'); }
    function removeDay(idx) { if(confirm('åˆªé™¤æ•´å¤©è¡Œç¨‹ï¼Ÿ')) { appData.itinerary.splice(idx, 1); renderView('itinerary'); } }
    function addItm(dIdx) { appData.itinerary[dIdx].items.push({time:'', title:'', desc:'', transport:'', mapUrl:'', hours:'', mustBuy:'', menu:'', voucher:'', photo:'', notes:''}); renderView('itinerary'); }
    function removeItm(dIdx, iIdx) { appData.itinerary[dIdx].items.splice(iIdx, 1); renderView('itinerary'); }
    function addTicket() { appData.tickets.push({name:'', date:'', time:'', priceAdult:'', priceChild:'', location:'', image:'', notes:''}); renderView('tickets'); }
    function addPhrase() { appData.phrases.unshift({zh:'', th:''}); renderView('phrases'); }
    function addShoppingItem() { appData.shopping.push({item:'', price:'', location:'', category:'', image:'', notes:'', done:false}); renderView('shopping'); }
    function addNote() { appData.notes.push({date:'', content:''}); renderView('notes'); }
    function removeArr(section, idx) { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { appData[section].splice(idx, 1); renderView(section); } }
    function toggleShopCheck(idx) { appData.shopping[idx].done = !appData.shopping[idx].done; saveToLocal(); renderView('shopping'); }

    function speak(lang, inputId, directText) { 
        const text = directText || document.getElementById(inputId).value;
        if(!text) return;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = lang; 
        const voices = window.speechSynthesis.getVoices();
        let targetVoice = voices.find(v => v.lang === 'th-TH') || voices.find(v => v.lang.startsWith('th'));
        if (targetVoice && lang.startsWith('th')) { msg.voice = targetVoice; }
        msg.rate = 0.9; 
        window.speechSynthesis.speak(msg); 
    }
    window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); };

    function mockTranslate() {
        const text = document.getElementById('trans-input').value;
        if (!text) { alert("è«‹å…ˆè¼¸å…¥ä¸­æ–‡ï¼"); return; }
        window.open(`https://translate.google.com/?sl=zh-TW&tl=th&text=${encodeURIComponent(text)}&op=translate`, '_blank');
    }

    let mapScale = 100;
    function zoomMap(delta) {
        if(delta === 0) mapScale = 100;
        else mapScale += delta;
        if(mapScale < 100) mapScale = 100;
        document.getElementById('mrt-img').style.width = mapScale + '%';
    }

    document.addEventListener('DOMContentLoaded', () => { 
        initAudio(); 
        renderView('itinerary'); 
    });
</script>

</body>
</html>