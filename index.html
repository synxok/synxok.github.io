<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 å®¸å®¸æ˜Ÿæ˜Ÿæ›¼è°·å¤§å†’éšª</title>
    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4AA3DF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png"> 
    
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. åŸºç¤ CSS --- */
        :root {
            --primary-color: #4AA3DF;
            --accent-color: #FFD700;
            --bg-color: #E0F7FA;
            --text-color: #444;
            --card-bg: rgba(255, 255, 255, 0.95);
            --nav-height: 85px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Itim', 'Noto Sans TC', cursive, sans-serif;
            margin: 0; padding: 0;
            background-image: url('èƒŒæ™¯åœ–.png'); 
            background-size: 300px; background-repeat: repeat; background-attachment: fixed;
            background-color: var(--bg-color); color: var(--text-color);
            padding-bottom: calc(var(--nav-height) + 20px); font-size: 16px;
            overscroll-behavior-y: contain; 
        }

        header {
            background: rgba(255, 255, 255, 0.9); padding: 15px 10px; text-align: center;
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100;
            padding-top: env(safe-area-inset-top); 
        }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary-color); display: flex; align-items: center; justify-content: center; gap: 10px; padding-top: 10px;}
        .header-icon { height: 35px; width: auto; mix-blend-mode: multiply; }
        
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .card {
            background: var(--card-bg); border-radius: 20px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 2px solid transparent; transition: transform 0.2s;
        }
        .card:hover { border-color: rgba(74, 163, 223, 0.2); }
        
        button {
            background-color: var(--primary-color); color: white; border: none; padding: 8px 15px;
            border-radius: 50px; font-family: inherit; cursor: pointer; font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: 0.2s;
        }
        button:active { transform: scale(0.95); }
        button.secondary { background-color: #FFB74D; }
        button.danger { background-color: #FF7043; }
        button.outline { background: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); }
        button.icon-btn { padding: 5px 10px; border-radius: 10px; font-size: 1.2rem; }
        button.full-width { width: 100%; margin-top: 15px; }

        input, textarea, select {
            width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 2px solid #eee;
            border-radius: 10px; font-family: inherit; background: #fff;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--primary-color); }
        textarea { resize: vertical; min-height: 80px; }
        label { font-weight: bold; color: #666; font-size: 0.9rem; display: block; margin-top: 10px; }
        
        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: white; display: flex; overflow-x: auto; align-items: center;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1); z-index: 1000; padding: 0 5px;
            -ms-overflow-style: none; scrollbar-width: none;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .bottom-nav::-webkit-scrollbar { display: none; }
        .nav-item {
            flex: 0 0 auto; width: 68px; text-align: center; padding: 5px; font-size: 0.75rem;
            color: #888; cursor: pointer; border-radius: 15px; margin: 0 2px; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .nav-item.active { background-color: rgba(74, 163, 223, 0.1); color: var(--primary-color); font-weight: bold; }
        .nav-icon-img { width: 32px; height: 32px; object-fit: contain; margin-bottom: 4px; display: block; mix-blend-mode: multiply; }
        
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .info-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding: 8px 0; align-items: baseline; }
        .info-label { color: #888; font-size: 0.9rem; min-width: 80px; }
        .info-value { font-weight: 500; text-align: right; flex-grow: 1; word-break: break-all;}
        .section-title { color: var(--primary-color); border-bottom: 3px solid var(--accent-color); padding-bottom: 5px; margin-bottom: 15px; margin-top: 25px; display: inline-block; font-size: 1.1rem; }
        .edit-controls { text-align: right; margin-bottom: 10px; }
        .edit-group { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #eee; position: relative; }
        .delete-btn-corner { position: absolute; top: 5px; right: 5px; font-size: 0.9rem; background: #FF7043; color: white; padding: 2px 8px; border-radius: 10px;}
        
        .day-header { background: var(--accent-color); color: #5d4037; padding: 10px 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .timeline-item { border-left: 3px solid var(--primary-color); padding-left: 15px; margin-left: 10px; margin-bottom: 20px; position: relative; }
        .timeline-item::before { content: 'â˜…'; position: absolute; left: -9px; top: 0; color: var(--accent-color); background: #fff; border-radius: 50%; }
        .detail-card { background: #fff; border: 1px solid #eee; border-radius: 10px; padding: 10px; margin-top: 5px; font-size: 0.9rem; }
        .detail-row { display: flex; gap: 8px; margin-bottom: 5px; align-items: flex-start; }
        .detail-icon { color: var(--primary-color); font-weight: bold; min-width: 45px; }

        .trans-box { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-bottom: 10px; }

        /* MRT ç¸®æ”¾ */
        #mrt-container { 
            overflow: auto; 
            border: 2px solid var(--primary-color); 
            border-radius: 10px; 
            height: 60vh; 
            background: white; 
            position: relative;
            -webkit-overflow-scrolling: touch; 
        }
        .zoom-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .zoom-btn {
            width: 45px; height: 45px; border-radius: 50%; background: var(--primary-color); color: white;
            font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none; padding: 0;
        }
        .zoom-btn:active { transform: scale(0.9); }
        .zoom-btn.reset { background: #607D8B; font-size: 1rem; }
        
        .shopping-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px dashed #ccc; }
        .shopping-item.checked { opacity: 0.5; text-decoration: line-through; }
        .check-circle { width: 22px; height: 22px; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px; cursor: pointer; background: white; }
        .checked .check-circle { background: #4CAF50; border-color: #4CAF50; color: white; }

        .emergency-section h4 { color: #D84315; border-bottom: 2px solid #FFAB91; display: inline-block; margin-top: 15px; margin-bottom: 5px;}
        .emergency-section p { margin: 5px 0; line-height: 1.5; }

        details { margin-bottom: 10px; background: white; border-radius: 10px; border: 1px solid #eee; }
        summary { padding: 10px; cursor: pointer; font-weight: bold; background: #f0f8ff; border-radius: 10px; list-style: none; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: ' â–¼'; float: right; }
        details[open] summary::after { content: ' â–²'; }
        .details-content { padding: 10px; }
    </style>
</head>
<body>

<header>
    <h1><span>ğŸ˜</span> 2026 å®¸å®¸æ˜Ÿæ˜Ÿæ›¼è°·å¤§å†’éšª <img src="TH flag.png" class="header-icon" alt="Thai Flag"></h1>
</header>

<div class="container">
    <div id="page-flights" class="page active">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('flights')" id="btn-edit-flights">âœï¸ ç·¨è¼¯</button></div>
            <div id="view-flights"></div>
            <div id="edit-flights" style="display:none;">
                <h3 class="section-title">âœˆï¸ å»ç¨‹ (Outbound)</h3><div id="edit-flights-outbound"></div>
                <h3 class="section-title">âœˆï¸ å›ç¨‹ (Inbound)</h3><div id="edit-flights-inbound"></div>
                <button onclick="saveData('flights')" class="full-width">ğŸ’¾ å„²å­˜èˆªç­è³‡æ–™</button>
            </div>
        </div>
    </div>
    <div id="page-hotel" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('hotel')" id="btn-edit-hotel">âœï¸ ç·¨è¼¯</button></div>
            <div id="view-hotel"></div>
            <div id="edit-hotel" style="display:none;">
                <div id="hotel-form-container"></div>
                <button class="secondary full-width" onclick="addHotel()">+ æ–°å¢é£¯åº—</button>
                <button onclick="saveData('hotel')" class="full-width">ğŸ’¾ å„²å­˜æ‰€æœ‰é£¯åº—</button>
            </div>
        </div>
    </div>
    <div id="page-itinerary" class="page">
        <div class="edit-controls"><button onclick="toggleEdit('itinerary')" id="btn-edit-itinerary">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
        <div id="view-itinerary"></div>
        <div id="edit-itinerary" style="display:none;">
            <div id="itinerary-form-container"></div>
            <button class="secondary full-width" onclick="addDay()">+ æ–°å¢ä¸€å¤©</button>
            <button onclick="saveData('itinerary')" class="full-width">ğŸ’¾ å…¨éƒ¨å„²å­˜</button>
        </div>
    </div>
    <div id="page-mrt" class="page">
        <div class="card">
            <h3>ğŸš‡ æ›¼è°·æ·é‹åœ–</h3>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomMap(-25)">ï¼</button>
                <button class="zoom-btn reset" onclick="zoomMap(0)">é‡ç½®</button>
                <button class="zoom-btn" onclick="zoomMap(25)">ï¼‹</button>
            </div>
            <p style="color:#666; font-size:0.8rem; text-align:center; margin-bottom:5px;">ğŸ’¡ æ”¾å¤§å¾Œå¯æ»‘å‹•æŸ¥çœ‹</p>
            <div id="mrt-container">
                <img id="mrt-img" src="bangkok_mrt_2025.png" alt="Bangkok MRT" style="width: 100%; min-width: 100%; transition: width 0.3s ease;" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Bangkok_Mass_Transit_Network_Map.png/1024px-Bangkok_Mass_Transit_Network_Map.png';this.alt='æœ¬åœ°åœ–ç‰‡æœªæ‰¾åˆ°'">
            </div>
        </div>
    </div>
    <div id="page-translate" class="page">
        <div class="card">
            <h3>ğŸ‡¹ğŸ‡­ ç¿»è­¯å°å¹«æ‰‹</h3>
            <div class="trans-box"><label>ä¸­æ–‡ (ZH)</label><textarea id="trans-input" placeholder="è¼¸å…¥ä¸­æ–‡..."></textarea><button class="outline" onclick="speak('zh-TW', 'trans-input')">ğŸ”Š æ’­æ”¾ä¸­æ–‡</button></div>
            <div style="text-align:center; margin: 10px 0;"><button class="icon-btn" style="width:auto; border-radius:20px;" onclick="mockTranslate()">â¬‡ï¸ è·³è½‰ Google ç¿»è­¯ â¬‡ï¸</button></div>
            <div class="trans-box" style="background:#E1F5FE;"><label>æ³°æ–‡ (TH)</label><textarea id="trans-output" placeholder="é»æ“ŠæŒ‰éˆ•ç¿»è­¯..."></textarea><button class="outline" onclick="speak('th-TH', 'trans-output')">ğŸ”Š æ’­æ”¾æ³°æ–‡</button></div>
        </div>
    </div>
    <div id="page-phrases" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('phrases')" id="btn-edit-phrases">âœï¸ ç®¡ç†</button></div>
            <div id="view-phrases"></div>
            <div id="edit-phrases" style="display:none;">
                <div id="phrases-form"></div>
                <button class="secondary full-width" onclick="addPhrase()">+ æ–°å¢å¥å‹</button>
                <button onclick="saveData('phrases')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>
    <div id="page-shopping" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('shopping')" id="btn-edit-shopping">âœï¸ ç·¨è¼¯æ¸…å–®</button></div>
            <div id="view-shopping"></div>
            <div id="edit-shopping" style="display:none;">
                <div id="shopping-form"></div>
                <button class="secondary full-width" onclick="addShoppingItem()">+ æ–°å¢å¿…è²·</button>
                <button onclick="saveData('shopping')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>
    <div id="page-notes" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('notes')" id="btn-edit-notes">âœï¸ å¯«ç­†è¨˜</button></div>
            <div id="view-notes"></div>
            <div id="edit-notes" style="display:none;">
                <div id="notes-form"></div>
                <button class="secondary full-width" onclick="addNote()">+ æ–°å¢ç­†è¨˜</button>
                <button onclick="saveData('notes')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>
    <div id="page-emergency" class="page">
        <div class="card emergency-section" style="border-left: 5px solid #FF7043;">
            <h3 style="color:#D84315; text-align:center;">ğŸ†˜ æ€¥é›£æ•‘åŠ©</h3>
            <h4>ã€Šå°ç£å¤–äº¤éƒ¨ã€‹</h4><p>æ€¥é›£æ•‘åŠ©å°ˆç·šï¼ˆæµ·å¤–ç›´æ’¥ï¼‰ï¼š<a href="tel:080008509">0800-085-09</a></p>
            <h4>ã€Šé§æ³°åœ‹å°åŒ—ç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ã€‹</h4>
            <p>ç·Šæ€¥é›»è©±ï¼ˆéä¸Šç­æ™‚é–“ï¼‰ï¼š<a href="tel:+66816664006" style="color:red; font-weight:bold;">+66-81-6664006</a></p>
            <p>è¾¦å…¬å®¤é›»è©±ï¼ˆä¸Šç­æ™‚é–“ï¼‰ï¼š<a href="tel:+6621193555">+66-2-119-3555</a></p>
            <p>é›»å­éƒµä»¶ï¼š<a href="mailto:tha@mofa.gov.tw">tha@mofa.gov.tw</a></p>
            <h4>ã€Šæ³°åœ‹ç•¶åœ°ç·Šæ€¥é›»è©±ã€‹</h4>
            <p><strong>è§€å…‰è­¦å¯Ÿï¼š1155</strong> (ä¸­æ–‡æœå‹™)</p><p>é†«ç™‚æ€¥æ•‘ä¸­å¿ƒï¼š1669 æˆ– 1554</p><p>æ¶ˆè²»è€…ä¿è­·è¾¦å…¬å®¤ï¼š1166</p>
            <p style="background:#FFF3E0; padding:10px; font-size:0.85rem; border-radius:10px; margin-top:10px;">æ€¥é›£æ•‘åŠ©å°ˆç·šåƒ…é™ç·Šæ€¥æƒ…æ³ï¼ˆè»Šç¦ã€æ¶åŠ«ã€ç”Ÿå‘½å®‰å±ï¼‰ã€‚<br>ä¸€èˆ¬å•é¡Œè«‹æ–¼ä¸Šç­æ™‚é–“è¯ç¹«è¾¦äº‹è™•ã€‚</p>
            <h4>ã€ŠLINEå¸³è™Ÿã€‹</h4><p>ä¿å¹³å®‰æœå‹™å°ˆç·š LINE ID: <strong>@Taiwan119</strong></p>
        </div>
        <div style="text-align:center; margin-top:20px;"><button onclick="resetApp()" class="danger" style="opacity:0.6;">âš ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button></div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchPage('flights', this)"><img src="airplane.png" class="nav-icon-img"><span>èˆªç­</span></div>
    <div class="nav-item" onclick="switchPage('hotel', this)"><img src="hotel.png" class="nav-icon-img"><span>é£¯åº—</span></div>
    <div class="nav-item" onclick="switchPage('itinerary', this)"><img src="liti.png" class="nav-icon-img"><span>è¡Œç¨‹</span></div>
    <div class="nav-item" onclick="switchPage('mrt', this)"><img src="train.png" class="nav-icon-img"><span>æ·é‹</span></div>
    <div class="nav-item" onclick="switchPage('translate', this)"><img src="man.png" class="nav-icon-img"><span>ç¿»è­¯</span></div>
    <div class="nav-item" onclick="switchPage('phrases', this)"><img src="TH flag.png" class="nav-icon-img"><span>æ³°æ–‡</span></div>
    <div class="nav-item" onclick="switchPage('shopping', this)"><img src="shoppingbag.png" class="nav-icon-img"><span>å¿…è²·</span></div>
    <div class="nav-item" onclick="switchPage('notes', this)"><img src="note.png" class="nav-icon-img"><span>ç­†è¨˜</span></div>
    <div class="nav-item" onclick="switchPage('emergency', this)"><img src="SOS.png" class="nav-icon-img"><span>æ±‚åŠ©</span></div>
</nav>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker è¨»å†ŠæˆåŠŸ', reg))
                .catch(err => console.log('Service Worker è¨»å†Šå¤±æ•—', err));
        });
    }

    const defaultPhrases = [
        {zh:"ä½ å¥½", th:"Sawasdee (krub/ka)"}, {zh:"è¬è¬", th:"Khop khun (krub/ka)"}, {zh:"å°ä¸èµ·", th:"Kor tot"}, {zh:"æ²’é—œä¿‚", th:"Mai pen rai"},
        {zh:"æ˜¯çš„", th:"Chai"}, {zh:"ä¸æ˜¯", th:"Mai chai"}, {zh:"å¤šå°‘éŒ¢?", th:"Tao rai?"}, {zh:"å¤ªè²´äº†", th:"Paeng pai"},
        {zh:"ä¾¿å®œä¸€é»", th:"Lot noi dai mai?"}, {zh:"æˆ‘æƒ³è¦é€™å€‹", th:"Ao an nee"}, {zh:"ä¸è¦", th:"Mai ao"}, {zh:"æœ‰...å—?", th:"Mee ... mai?"},
        {zh:"å»æ‰€åœ¨å“ª?", th:"Hong nam yoo tee nai?"}, {zh:"ç›´èµ°", th:"Dtrohng bpai"}, {zh:"å·¦è½‰", th:"Liao sai"}, {zh:"å³è½‰", th:"Liao kwa"},
        {zh:"æ•‘å‘½", th:"Chuay duay"}, {zh:"é†«é™¢", th:"Rong payaban"}, {zh:"è­¦å¯Ÿ", th:"Dtam ruat"}, {zh:"æˆ‘è¿·è·¯äº†", th:"Chan long tang"},
        {zh:"å¥½", th:"Dee"}, {zh:"å¥½åƒ", th:"Aroy"}, {zh:"ä¸è¾£", th:"Mai phet"}, {zh:"ä¸€é»é»è¾£", th:"Phet nit noi"},
        {zh:"ä¸è¦é¦™èœ", th:"Mai sai pak chee"}, {zh:"è²·å–®", th:"Check bin / Gep tang"}, {zh:"æ°´", th:"Nam"}, {zh:"å†°å¡Š", th:"Nam kaeng"},
        {zh:"ç†±", th:"Ron"}, {zh:"å†·", th:"Nao/Yen"}, {zh:"èˆ’æœ", th:"Sabai"}, {zh:"æ¼‚äº®", th:"Suay"}, {zh:"å¯æ„›", th:"Narak"},
        {zh:"å¹¾é»?", th:"Gee mong?"}, {zh:"ä»€éº¼?", th:"Arai na?"}, {zh:"ä¸æ‡‚/ä¸æ˜ç™½", th:"Mai kao jai"}, {zh:"å¯ä»¥æ‹ç…§å—?", th:"Tai roop dai mai?"},
        {zh:"æ©Ÿå ´", th:"Sanam bin"}, {zh:"é£¯åº—", th:"Rong raem"}, {zh:"è¨ˆç¨‹è»Š", th:"Taxi"}, {zh:"åœåœ¨é€™è£¡", th:"Jort tee nee"},
        {zh:"å»...", th:"Bpai ..."}, {zh:"é€™è£¡", th:"Tee nee"}, {zh:"é‚£è£¡", th:"Tee nan"}, {zh:"ç¾åœ¨", th:"Dton nee"},
        {zh:"ä»Šå¤©", th:"Wan nee"}, {zh:"æ˜å¤©", th:"Prung nee"}, {zh:"æ˜¨å¤©", th:"Meua wan"}, {zh:"ç”·äºº", th:"Poo chai"}, {zh:"å¥³äºº", th:"Poo ying"}
    ];

    const defaultData = {
        flights: { 
            outbound: { airline: 'æ˜Ÿå®‡èˆªç©º', number: 'JX741', date: '2026-02-10', time: '10:00', gate: 'B5', pnr: 'AB1234', passengers: [{name:'å®¸å®¸', seat:'12A'}, {name:'æ˜Ÿæ˜Ÿ', seat:'12B'}] }, 
            inbound: { airline: 'æ˜Ÿå®‡èˆªç©º', number: 'JX742', date: '2026-02-15', time: '14:00', gate: 'D2', pnr: 'AB1234', passengers: [{name:'å®¸å®¸', seat:'15C'}, {name:'æ˜Ÿæ˜Ÿ', seat:'15D'}] } 
        },
        hotels: [
            { name: 'The Standard, Bangkok', address: '114 Narathiwas Road', transport:'BTS Chong Nonsi', checkin:'2026-02-10', checkout:'2026-02-13', voucher:'', photo:'', surroundings:'è¿‘æœ€é«˜æ¨“è§€æ™¯å°', notes: 'è¨˜å¾—è¦é«˜æ¨“å±¤' }
        ],
        itinerary: [
            { 
                date: '2026-02-10', summary: 'æŠµé”æ›¼è°·', 
                items: [
                    { time:'14:00', title:'é£¯åº— Check-in', desc:'è¾¦ç†å…¥ä½æ‰‹çºŒ', transport:'æ©Ÿå ´å¿«ç·š', mapUrl:'', hours:'24H', mustBuy:'', menu:'', voucher:'Agoda.pdf', photo:'', notes:'è­·ç…§è¦æº–å‚™å¥½' },
                    { time:'18:00', title:'å–¬å¾·å¤œå¸‚', desc:'åƒæ™šé¤é€›è¡—', transport:'MRT Phra Ram 9', mapUrl:'', hours:'17:00-00:00', mustBuy:'æ°´æœè¥¿æ–½å†°æ²™', menu:'ç«å±±æ’éª¨', voucher:'', photo:'', notes:'äººå¤šå°å¿ƒéŒ¢åŒ…' }
                ] 
            }
        ],
        phrases: defaultPhrases,
        shopping: [{ item:'æ‰‹æ¨™å¥¶èŒ¶', price:'140', location:'Big C', done: false }],
        notes: [{ date: 'æé†’', content: 'è¨ˆç¨‹è»Šè¦è¨˜å¾—å–Š By Meter (è·³è¡¨)ï¼' }]
    };

    let appData = JSON.parse(localStorage.getItem('travelApp2026_V5')) || defaultData;
    if(!Array.isArray(appData.hotels)) appData.hotels = [appData.hotels || defaultData.hotels[0]];
    if(appData.phrases.length < 10) appData.phrases = defaultPhrases;

    function saveToLocal() { localStorage.setItem('travelApp2026_V5', JSON.stringify(appData)); }
    function resetApp() { if(confirm("âš ï¸ ç¢ºå®šé‡ç½®ï¼Ÿæ‰€æœ‰è³‡æ–™å°‡æ¶ˆå¤±ï¼")) { localStorage.removeItem('travelApp2026_V5'); location.reload(); } }

    function switchPage(pageId, navEl) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navEl.classList.add('active');
        renderView(pageId);
    }
    function toggleEdit(section) {
        const v = document.getElementById(`view-${section}`);
        const e = document.getElementById(`edit-${section}`);
        const btn = document.getElementById(`btn-edit-${section}`);
        if (e.style.display === 'none') { e.style.display = 'block'; v.style.display = 'none'; btn.innerText = 'ğŸ‘€ è¿”å›æª¢è¦–'; } 
        else { e.style.display = 'none'; v.style.display = 'block'; btn.innerText = 'âœï¸ ç·¨è¼¯'; }
        renderView(section);
    }

    const renderers = {
        flights: () => {
            const flightFields = { airline: 'èˆªç©ºå…¬å¸', number: 'èˆªç­', date: 'æ—¥æœŸ', time: 'æ™‚é–“', gate: 'ç™»æ©Ÿé–€', pnr: 'ä»£ç¢¼' };
            const genView = (t, d) => {
                let h = `<h3 class="section-title">${t}</h3>`;
                for (let k in flightFields) h += `<div class="info-row"><span class="info-label">${flightFields[k]}</span><span class="info-value">${d[k] || '-'}</span></div>`;
                h += `<div class="info-row"><span class="info-label">æ—…å®¢/åº§ä½</span><span class="info-value">` + (d.passengers || []).map(p => `${p.name}(${p.seat})`).join(', ') + `</span></div>`;
                return h;
            };
            document.getElementById('view-flights').innerHTML = genView('âœˆï¸ å»ç¨‹', appData.flights.outbound) + '<br>' + genView('âœˆï¸ å›ç¨‹', appData.flights.inbound);
            const genEdit = (type, data) => {
                let html = '';
                for (let k in flightFields) html += `<label>${flightFields[k]}</label><input value="${data[k]||''}" onchange="appData.flights.${type}.${k}=this.value">`;
                html += `<label>æ—…å®¢è³‡è¨Š (å§“å / åº§ä½)</label><div id="passengers-${type}">`;
                (data.passengers || []).forEach((p, idx) => {
                    html += `<div style="display:flex; gap:5px; margin-bottom:5px;"><input placeholder="å§“å" value="${p.name}" onchange="appData.flights.${type}.passengers[${idx}].name=this.value"><input placeholder="åº§ä½" value="${p.seat}" onchange="appData.flights.${type}.passengers[${idx}].seat=this.value"><button class="danger icon-btn" onclick="removePax('${type}', ${idx})">ğŸ—‘ï¸</button></div>`;
                });
                html += `</div><button class="secondary outline full-width" onclick="addPax('${type}')">â• æ–°å¢æ—…å®¢</button>`;
                return html;
            };
            document.getElementById('edit-flights-outbound').innerHTML = genEdit('outbound', appData.flights.outbound);
            document.getElementById('edit-flights-inbound').innerHTML = genEdit('inbound', appData.flights.inbound);
        },
        hotel: () => {
            document.getElementById('view-hotel').innerHTML = appData.hotels.map((h, i) => `
                <div style="border-bottom:3px solid var(--accent-color); padding-bottom:15px; margin-bottom:15px;">
                    <h3 style="color:var(--primary-color); margin-bottom:5px;">ğŸ¨ ${i+1}. ${h.name}</h3>
                    <div class="info-row"><span class="info-label">åœ°å€</span><span class="info-value">${h.address}</span></div>
                    <div class="info-row"><span class="info-label">äº¤é€š</span><span class="info-value">${h.transport}</span></div>
                    <div class="info-row"><span class="info-label">æ—¥æœŸ</span><span class="info-value">${h.checkin} ~ ${h.checkout}</span></div>
                    <div class="info-row"><span class="info-label">æ†‘è­‰</span><span class="info-value">${h.voucher}</span></div>
                    ${h.photo ? `<div class="info-row"><span class="info-label">ç…§ç‰‡</span><span class="info-value">${h.photo}</span></div>` : ''}
                    <div class="detail-card" style="background:#FFF9C4;"><div><b>é€±é‚Šç’°å¢ƒï¼š</b>${h.surroundings}</div><div style="margin-top:5px;"><b>å‚™è¨»ï¼š</b>${h.notes}</div></div>
                </div>`).join('');
            const fields = { name:'é£¯åº—åç¨±', address:'åœ°å€', transport:'äº¤é€šæ–¹å¼', checkin:'å…¥ä½ (YYYY-MM-DD)', checkout:'é€€æˆ¿', voucher:'å…¥ä½æ†‘è­‰', photo:'ç…§ç‰‡é€£çµ', surroundings:'é€±é‚Šç’°å¢ƒ', notes:'å‚™è¨»' };
            document.getElementById('hotel-form-container').innerHTML = appData.hotels.map((h, idx) => `
                <div class="edit-group">
                    <button class="icon-btn delete-btn-corner danger" onclick="removeHotel(${idx})">ğŸ—‘ï¸</button>
                    <h4 style="margin-top:0;">é£¯åº— ${idx+1}</h4>
                    ${Object.entries(fields).map(([k, label]) => `<label>${label}</label>${(k.includes('notes')||k.includes('surr')) ? `<textarea onchange="appData.hotels[${idx}].${k}=this.value">${h[k]}</textarea>` : `<input value="${h[k]}" onchange="appData.hotels[${idx}].${k}=this.value">`}`).join('')}
                </div>`).join('');
        },
        itinerary: () => {
            document.getElementById('view-itinerary').innerHTML = appData.itinerary.map(d => `
                <div class="day-header"><span>${d.date}</span><span>${d.summary}</span></div>
                ${d.items.map(i => {
                    const mapLink = i.mapUrl ? `<a href="${i.mapUrl}" target="_blank">ğŸ“ é»é–‹åœ°åœ–</a>` : (i.title ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i.title + ' Bangkok')}" target="_blank">ğŸ” æœåœ°åœ–</a>` : '');
                    return `
                    <div class="timeline-item">
                        <div style="background: #E1F5FE; padding: 8px 12px; border-radius: 10px; margin-bottom: 8px; display: inline-block; width: 100%;">
                            <div style="font-weight:bold; color:var(--primary-color); font-size:1.1rem;">${i.time} ${i.title}</div>
                            <div style="color:#555; font-size:0.9rem;">${i.desc || ''}</div>
                        </div>
                        <div class="detail-card">
                            ${i.transport ? `<div class="detail-row"><span class="detail-icon">ğŸšŒ</span> ${i.transport}</div>` : ''}
                            ${mapLink ? `<div class="detail-row"><span class="detail-icon">ğŸ—ºï¸</span> ${mapLink}</div>` : ''}
                            ${i.hours ? `<div class="detail-row"><span class="detail-icon">ğŸ•’</span> ${i.hours}</div>` : ''}
                            ${i.mustBuy ? `<div class="detail-row"><span class="detail-icon">ğŸ›ï¸</span> å¿…è²·: ${i.mustBuy}</div>` : ''}
                            ${i.menu ? `<div class="detail-row"><span class="detail-icon">ğŸ´</span> æ¨è–¦: ${i.menu}</div>` : ''}
                            ${i.voucher ? `<div class="detail-row"><span class="detail-icon">ğŸ«</span> æ†‘è­‰: ${i.voucher}</div>` : ''}
                            ${i.notes ? `<div class="detail-row"><span class="detail-icon">ğŸ“</span> å‚™è¨»: ${i.notes}</div>` : ''}
                        </div>
                    </div>`;
                }).join('')}`).join('');
            const itemFields = { time:'æ™‚é–“', title:'æ¨™é¡Œ', desc:'ç°¡è¿°', transport:'äº¤é€š', mapUrl:'Googleåœ°åœ–é€£çµ', hours:'ç‡Ÿæ¥­æ™‚é–“', mustBuy:'å¿…è²·', menu:'æ¨è–¦èœå–®', voucher:'æ†‘è­‰', photo:'ç…§ç‰‡', notes:'å‚™è¨»' };
            document.getElementById('itinerary-form-container').innerHTML = appData.itinerary.map((d, dIdx) => `
                <div class="edit-group" style="border:2px solid var(--accent-color);">
                    <button class="icon-btn delete-btn-corner danger" onclick="removeDay(${dIdx})">ğŸ—‘ï¸</button>
                    <label>Day ${dIdx+1} æ—¥æœŸ</label><input type="date" value="${d.date}" onchange="appData.itinerary[${dIdx}].date=this.value"><label>ç•¶æ—¥ä¸»é¡Œ</label><input value="${d.summary}" onchange="appData.itinerary[${dIdx}].summary=this.value"><hr style="margin:10px 0;"><label>è¡Œç¨‹é …ç›® (é»æ“Šå±•é–‹)</label>
                    <div id="day-${dIdx}-items">${d.items.map((item, iIdx) => `<details><summary>${item.time || 'æ™‚é–“'} - ${item.title || 'é …ç›®'} <span onclick="removeItm(${dIdx}, ${iIdx})" style="float:right; color:red;">ğŸ—‘ï¸</span></summary><div class="details-content">${Object.entries(itemFields).map(([k, label]) => `<label>${label}</label><input value="${item[k]||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].${k}=this.value">`).join('')}</div></details>`).join('')}</div>
                    <button class="outline full-width" onclick="addItm(${dIdx})">â• æ–°å¢é …ç›®</button>
                </div>`).join('');
        },
        phrases: () => {
            document.getElementById('view-phrases').innerHTML = appData.phrases.map(p => `<div class="card" style="padding:10px; display:flex; justify-content:space-between; align-items:center;"><div><div style="font-weight:bold;">${p.zh}</div><div style="color:var(--primary-color)">${p.th}</div></div><button class="icon-btn" onclick="speak('th-TH', null, '${p.th}')">ğŸ”Š</button></div>`).join('');
            document.getElementById('phrases-form').innerHTML = appData.phrases.map((p, i) => `<div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('phrases', ${i})">ğŸ—‘ï¸</button><input placeholder="ä¸­æ–‡" value="${p.zh}" onchange="appData.phrases[${i}].zh=this.value"><input placeholder="æ³°æ–‡" value="${p.th}" onchange="appData.phrases[${i}].th=this.value"></div>`).join('');
        },
        shopping: () => {
            document.getElementById('view-shopping').innerHTML = appData.shopping.map((s, i) => `<div class="shopping-item ${s.done ? 'checked' : ''}"><div class="check-circle" onclick="toggleShopCheck(${i})">${s.done ? 'âœ”' : ''}</div><div style="flex-grow:1;"><b>${s.item}</b> <span style="font-size:0.8rem; background:#eee;">${s.location}</span></div><div style="font-weight:bold; color:var(--primary-color);">à¸¿${s.price}</div></div>`).join('');
            document.getElementById('shopping-form').innerHTML = appData.shopping.map((s, i) => `<div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('shopping', ${i})">ğŸ—‘ï¸</button><input placeholder="å“é …" value="${s.item}" onchange="appData.shopping[${i}].item=this.value"><input placeholder="åƒ¹æ ¼" value="${s.price}" onchange="appData.shopping[${i}].price=this.value"><input placeholder="åœ°é»" value="${s.location}" onchange="appData.shopping[${i}].location=this.value"></div>`).join('');
        },
        notes: () => {
            document.getElementById('view-notes').innerHTML = appData.notes.map(n => `<div class="card" style="background:#FFF9C4; white-space:pre-wrap;"><b>${n.date}</b>\n${n.content}</div>`).join('');
            document.getElementById('notes-form').innerHTML = appData.notes.map((n, i) => `<div class="edit-group"><button class="icon-btn delete-btn-corner danger" onclick="removeArr('notes', ${i})">ğŸ—‘ï¸</button><input placeholder="æ¨™é¡Œ" value="${n.date}" onchange="appData.notes[${i}].date=this.value"><textarea placeholder="å…§å®¹" onchange="appData.notes[${i}].content=this.value">${n.content}</textarea></div>`).join('');
        }
    };

    function renderView(section) { if(renderers[section]) renderers[section](); }
    function saveData(section) { saveToLocal(); alert('âœ¨ å„²å­˜æˆåŠŸï¼'); toggleEdit(section); }
    function addPax(type) { appData.flights[type].passengers.push({name:'', seat:''}); renderView('flights'); }
    function removePax(type, idx) { appData.flights[type].passengers.splice(idx, 1); renderView('flights'); }
    function addHotel() { appData.hotels.push({name:'', address:'', transport:'', checkin:'', checkout:'', voucher:'', photo:'', surroundings:'', notes:''}); renderView('hotel'); }
    function removeHotel(idx) { if(confirm('åˆªé™¤æ­¤é£¯åº—ï¼Ÿ')) { appData.hotels.splice(idx, 1); renderView('hotel'); } }
    function addDay() { appData.itinerary.push({date:'', summary:'', items:[]}); renderView('itinerary'); }
    function removeDay(idx) { if(confirm('åˆªé™¤æ•´å¤©è¡Œç¨‹ï¼Ÿ')) { appData.itinerary.splice(idx, 1); renderView('itinerary'); } }
    function addItm(dIdx) { appData.itinerary[dIdx].items.push({time:'', title:'', desc:'', transport:'', mapUrl:'', hours:'', mustBuy:'', menu:'', voucher:'', photo:'', notes:''}); renderView('itinerary'); }
    function removeItm(dIdx, iIdx) { appData.itinerary[dIdx].items.splice(iIdx, 1); renderView('itinerary'); }
    function addPhrase() { appData.phrases.unshift({zh:'', th:''}); renderView('phrases'); }
    function addShoppingItem() { appData.shopping.push({item:'', price:'', location:'', done:false}); renderView('shopping'); }
    function addNote() { appData.notes.push({date:'', content:''}); renderView('notes'); }
    function removeArr(section, idx) { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { appData[section].splice(idx, 1); renderView(section); } }
    function toggleShopCheck(idx) { appData.shopping[idx].done = !appData.shopping[idx].done; saveToLocal(); renderView('shopping'); }

    function speak(lang, inputId, directText) { 
        const text = directText || document.getElementById(inputId).value;
        if(!text) return;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = lang; 
        const voices = window.speechSynthesis.getVoices();
        let targetVoice = voices.find(v => v.lang === 'th-TH') || voices.find(v => v.lang.startsWith('th'));
        if (targetVoice && lang.startsWith('th')) { msg.voice = targetVoice; }
        msg.rate = 0.9; 
        window.speechSynthesis.speak(msg); 
    }
    window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); };

    function mockTranslate() {
        const text = document.getElementById('trans-input').value;
        if (!text) { alert("è«‹å…ˆè¼¸å…¥ä¸­æ–‡ï¼"); return; }
        window.open(`https://translate.google.com/?sl=zh-TW&tl=th&text=${encodeURIComponent(text)}&op=translate`, '_blank');
    }

    let mapScale = 100;
    function zoomMap(delta) {
        if(delta === 0) mapScale = 100;
        else mapScale += delta;
        if(mapScale < 100) mapScale = 100;
        document.getElementById('mrt-img').style.width = mapScale + '%';
    }

    document.addEventListener('DOMContentLoaded', () => { renderView('flights'); });
</script>

</body>
</html>