<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 å®¸å®¸æ˜Ÿæ˜Ÿæ›¼è°·å¤§å†’éšª</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4AA3DF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png"> 
    
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. åŸºç¤ CSS --- */
        :root {
            --primary-color: #4AA3DF;
            --primary-dark: #3588c0;
            --accent-color: #FFD700;
            --bg-color: #E0F7FA;
            --text-color: #444;
            --card-bg: rgba(255, 255, 255, 0.96);
            --nav-height: 85px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Itim', 'Noto Sans TC', cursive, sans-serif;
            margin: 0; padding: 0;
            background-image: url('èƒŒæ™¯åœ–.png');
            background-size: 300px; background-repeat: repeat; background-attachment: fixed;
            background-color: var(--bg-color); color: var(--text-color);
            padding-bottom: calc(var(--nav-height) + 20px); font-size: 16px;
        }

        /* --- ğŸŒŸ è±ªè¯éå ´å‹•ç•« --- */
        #splash-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #E1F5FE; 
            background-image: url('pattern1.png');
            background-size: 300px; 
            background-repeat: repeat;
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-out; text-align: center;
        }
        .splash-icon { width: 250px; height: 250px; border-radius: 50px; object-fit: cover; box-shadow: 0 20px 40px rgba(0,0,0,0.15); margin-bottom: 30px; animation: float 3s ease-in-out infinite; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .splash-icon img { width: 100%; height: 100%; object-fit: cover; }
        .splash-plane { position: absolute; width: 200px; z-index: 25; filter: drop-shadow(10px 10px 5px rgba(0,0,0,0.1)); animation: planeFly 5s linear forwards; pointer-events: none; }
        @keyframes planeFly { 0% { left: -30vw; bottom: -30vh; transform: rotate(-35deg) scale(0.8); } 100% { left: 130vw; bottom: 130vh; transform: rotate(-35deg) scale(1.2); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .loading-dots { display: flex; justify-content: center; margin-bottom: 10px; }
        .loading-dots span { display: inline-block; width: 15px; height: 15px; border-radius: 50%; margin: 0 5px; animation: bounce 1.4s infinite ease-in-out both; }
        .loading-dots span:nth-child(1) { background: #FF9800; animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { background: #FFEB3B; animation-delay: -0.16s; }
        .loading-dots span:nth-child(3) { background: #4CAF50; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        #start-btn { margin-top: 30px; font-size: 1.5rem; padding: 12px 50px; background: var(--accent-color); color: #5d4037; border-radius: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: none; cursor: pointer; animation: breathe 2s infinite; font-weight: bold; font-family: inherit;}
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* --- ä¸»ä»‹é¢ --- */
        header { background: rgba(255, 255, 255, 0.92); padding: 15px 10px; text-align: center; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 4px 15px rgba(74, 163, 223, 0.15); position: sticky; top: 0; z-index: 100; padding-top: env(safe-area-inset-top); backdrop-filter: blur(8px); }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary-color); display: flex; align-items: center; justify-content: center; gap: 8px; animation: floatHeader 4s ease-in-out infinite; padding-top: 5px; }
        @keyframes floatHeader { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .header-icon { height: 35px; width: auto; mix-blend-mode: multiply; }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        .card { background: var(--card-bg); border-radius: 25px; padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); border: 2px solid #fff; transition: transform 0.2s; animation: slideUp 0.5s; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        button { background-color: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 50px; font-family: inherit; cursor: pointer; font-size: 0.95rem; font-weight: bold; box-shadow: 0 4px 10px rgba(74, 163, 223, 0.3); transition: all 0.2s; }
        button:active { transform: scale(0.9); }
        button.secondary { background-color: #FFB74D; box-shadow: 0 4px 10px rgba(255, 183, 77, 0.4); }
        button.danger { background-color: #FF7043; box-shadow: 0 4px 10px rgba(255, 112, 67, 0.4); }
        button.success { background-color: #66BB6A; box-shadow: 0 4px 10px rgba(102, 187, 106, 0.4); }
        button.outline { background: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); box-shadow: none; display:inline-block; text-align:center;}
        button.icon-btn { padding: 6px 12px; border-radius: 15px; font-size: 1.1rem; }
        button.full-width { width: 100%; margin-top: 15px; animation: breatheBtn 3s infinite; }
        @keyframes breatheBtn { 0%, 100% { box-shadow: 0 4px 10px rgba(74, 163, 223, 0.3); } 50% { box-shadow: 0 4px 20px rgba(74, 163, 223, 0.6); } }

        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0 15px 0; border: 2px solid #eee; border-radius: 15px; font-family: inherit; background: #fff; transition: 0.3s; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary-color); }
        label { font-weight: bold; color: #555; font-size: 0.9rem; display: block; margin-top: 12px; }

        /* å°èˆª */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: rgba(255, 255, 255, 0.98); display: flex; overflow-x: auto; align-items: center; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000; padding: 0 5px; -ms-overflow-style: none; scrollbar-width: none; padding-bottom: env(safe-area-inset-bottom); border-top-left-radius: 25px; border-top-right-radius: 25px; }
        .bottom-nav::-webkit-scrollbar { display: none; }
        .nav-item { flex: 0 0 auto; width: 68px; text-align: center; padding: 5px; font-size: 0.7rem; color: #999; cursor: pointer; border-radius: 20px; margin: 0 3px; transition: 0.3s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-item.active { background-color: rgba(74, 163, 223, 0.15); color: var(--primary-color); font-weight: bold; transform: translateY(-5px); }
        .nav-icon-img { width: 34px; height: 34px; object-fit: contain; margin-bottom: 4px; display: block; mix-blend-mode: multiply; }
        
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .info-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding: 12px 0; align-items: baseline; }
        .info-label { color: #888; font-size: 0.9rem; min-width: 90px; font-weight: bold; }
        .info-value { font-weight: 500; text-align: right; flex-grow: 1; word-break: break-all; color: #444; }
        .section-title { color: var(--primary-color); font-size: 1.15rem; font-weight: bold; border-bottom: 3px solid var(--accent-color); padding-bottom: 6px; margin: 20px 0 15px 0; display: inline-block; }
        .edit-controls { text-align: right; margin-bottom: 10px; }
        .edit-group { background: #f8fbfd; padding: 20px; border-radius: 20px; margin-bottom: 15px; border: 2px solid #eef6fb; position: relative; }
        
        /* ğŸ“± å¯¦é«”ã€Œæ»¾è»¸ã€è¨­å®šï¼šè§£æ±ºç„¡æ³•æ»‘å‹•çš„é«”é©—å•é¡Œ */
        .date-tabs-container { 
            display: flex; 
            flex-wrap: nowrap; 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch; 
            gap: 10px; 
            padding: 5px 5px 15px 5px; /* åº•éƒ¨ä¿ç•™ç©ºé–“çµ¦æ»¾è»¸ */
            margin-bottom: 10px; 
            width: 100%;
        }
        
        /* è‡ªè¨‚ç¾è§€çš„æ©«å‘æ»¾å‹•æ¢ */
        .date-tabs-container::-webkit-scrollbar {
            height: 6px; /* æ»¾è»¸é«˜åº¦ */
        }
        .date-tabs-container::-webkit-scrollbar-track {
            background: rgba(74, 163, 223, 0.1); /* æ·ºè—è‰²è»Œé“ */
            border-radius: 10px;
        }
        .date-tabs-container::-webkit-scrollbar-thumb {
            background: var(--primary-color); /* ä¸»é¡Œè—è‰²æ»¾å‹•æ¢ */
            border-radius: 10px;
        }
        .date-tabs-container::-webkit-scrollbar-thumb:active {
            background: var(--primary-dark);
        }

        .date-tab { 
            flex: 0 0 auto; 
            white-space: nowrap; 
            padding: 8px 18px; 
            background: #fff; 
            border: 2px solid #eee; 
            border-radius: 20px; 
            font-size: 0.95rem; 
            color: #888; 
            cursor: pointer; 
            text-align: center; 
            transition: 0.3s; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .date-tab.active { 
            background: var(--primary-color); 
            color: white; 
            border-color: var(--primary-color); 
            transform: scale(1.05); 
            box-shadow: 0 4px 10px rgba(74, 163, 223, 0.3); 
            font-weight: bold;
        }

        /* è¡Œç¨‹é …ç›® */
        .timeline-item { border-left: 4px solid var(--primary-color); padding-left: 20px; margin-left: 10px; margin-bottom: 25px; position: relative; }
        .timeline-item::before { content: 'â˜…'; position: absolute; left: -11px; top: 0; color: var(--accent-color); background: #fff; border-radius: 50%; width: 22px; height: 22px; text-align: center; line-height: 24px; border: 2px solid var(--bg-color); }
        .detail-card { background: #fff; border: 1px solid #f0f0f0; border-radius: 15px; padding: 15px; margin-top: 8px; font-size: 0.95rem; }
        
        .move-btn { cursor: pointer; font-size: 1.2rem; padding: 0 8px; user-select: none; transition: 0.2s; display:inline-block; }
        .move-btn:active { transform: scale(0.8); }

        /* åå¸é€šçŸ¥ */
        #toast-container { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); z-index: 2000; pointer-events: none; }
        .toast { background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 30px; margin-top: 10px; animation: slideUp 0.3s; backdrop-filter: blur(5px); }

        #mrt-container { overflow: auto; border: 4px solid var(--primary-color); border-radius: 20px; height: 60vh; background: white; }
        .zoom-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
        
        .shopping-item { display: flex; align-items: flex-start; padding: 15px 10px; border-bottom: 1px dashed #ddd; transition: background 0.2s; background: #fff; border-radius:15px; margin-bottom:10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);}
        .shopping-item.checked { opacity: 0.6; background: #f9f9f9; }
        .shopping-item.checked .shop-details { text-decoration: line-through; color:#aaa; }
        .check-circle { width: 26px; height: 26px; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; cursor: pointer; background: white; flex-shrink: 0; margin-top: 3px; transition: all 0.3s; }
        .checked .check-circle { background: #4CAF50; border-color: #4CAF50; color: white; transform: scale(1.1); }
        
        .transfer-box { background: #37474F; color: #eceff1; padding: 20px; border-radius: 20px; margin-top: 20px; }
        .auto-img { max-width: 100%; border-radius: 10px; margin-top: 8px; border: 1px solid #eee; display: block; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .file-upload-btn { background: #f0f0f0; color: #333; font-size: 0.8rem; padding: 10px; border: 2px dashed #ccc; border-radius: 12px; width: 100%; margin-top: 5px; display: inline-block; cursor: pointer; text-align: center; font-weight: bold;}
    </style>
</head>
<body>

<audio id="audio-opening" src="opening.mp3" preload="auto"></audio>
<audio id="audio-bgm" src="bgm.mp3" loop preload="auto"></audio>
<audio id="audio-click" src="click.mp3" preload="auto"></audio>
<audio id="audio-page-effect" preload="auto"></audio>

<div id="splash-screen">
    <img src="airplane1.png" alt="é£›æ©Ÿ" class="splash-plane">
    <div class="splash-icon">
        <img src="icon.png" alt="åœ–ç¤º">
    </div>
    <h1>2026 å®¸å®¸æ˜Ÿæ˜Ÿ<br>æ›¼è°·å¤§å†’éšª</h1>
    <div class="loading-dots"><span></span><span></span><span></span></div>
    <button id="start-btn" onclick="startApp()">ğŸš€ å‡ºç™¼ï¼</button>
</div>

<div id="toast-container"></div>

<header>
    <h1>
        <img src="TH flag.png" class="header-icon" alt="ğŸ‡¹ğŸ‡­"> 
        2026 å®¸å®¸æ˜Ÿæ˜Ÿæ›¼è°·å¤§å†’éšª 
        <img src="elephant.png" class="header-icon" alt="ğŸ˜">
    </h1>
</header>

<div class="container">
    
    <div id="page-flights" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('flights')" id="btn-edit-flights">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
            <div id="view-flights"></div>
            <div id="edit-flights" style="display:none;">
                <div class="edit-group" style="border-top: 5px solid #4AA3DF;">
                    <h3 style="margin-top:0; color:var(--primary-dark);">ğŸ›« å»ç¨‹ (Outbound)</h3>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>èˆªç©ºå…¬å¸</label><input type="text" id="fl-out-air" placeholder="å¦‚ï¼šæ˜Ÿå®‡" onchange="appData.flights.outbound.airline=this.value"></div>
                        <div style="flex:1"><label>èˆªç­è™Ÿç¢¼</label><input type="text" id="fl-out-no" placeholder="å¦‚ï¼šJX741" onchange="appData.flights.outbound.flightNo=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>æ—¥æœŸ</label><input type="date" id="fl-out-date" onchange="appData.flights.outbound.date=this.value"></div>
                        <div style="flex:1"><label>èˆªå»ˆ</label><input type="text" id="fl-out-term" placeholder="å¦‚ï¼šT1" onchange="appData.flights.outbound.terminal=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>å‡ºç™¼æ™‚é–“</label><input type="time" id="fl-out-dep" onchange="appData.flights.outbound.depTime=this.value"></div>
                        <div style="flex:1"><label>åˆ°é”æ™‚é–“</label><input type="time" id="fl-out-arr" onchange="appData.flights.outbound.arrTime=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>ç™»æ©Ÿæ™‚é–“</label><input type="time" id="fl-out-board" onchange="appData.flights.outbound.boardingTime=this.value"></div>
                        <div style="flex:1"><label>ç™»æ©Ÿé–€</label><input type="text" id="fl-out-gate" placeholder="å¦‚ï¼šB5" onchange="appData.flights.outbound.gate=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>è¨‚ä½ä»£ç¢¼ PNR</label><input type="text" id="fl-out-pnr" onchange="appData.flights.outbound.pnr=this.value"></div>
                        <div style="flex:1"><label>ç¥¨åƒ¹</label><input type="text" id="fl-out-fare" placeholder="å¦‚ï¼š$12,000" onchange="appData.flights.outbound.fare=this.value"></div>
                    </div>
                    <label>ğŸ‘¥ ä¹˜å®¢åå–®èˆ‡åº§ä½</label>
                    <div id="fl-out-passengers"></div>
                    <button class="outline full-width" onclick="addPassenger('outbound')" style="margin-top:10px;">+ æ–°å¢ä¹˜å®¢</button>
                </div>
                
                <div class="edit-group" style="border-top: 5px solid #FF7043;">
                    <h3 style="margin-top:0; color:#D84315;">ğŸ›¬ å›ç¨‹ (Inbound)</h3>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>èˆªç©ºå…¬å¸</label><input type="text" id="fl-in-air" placeholder="å¦‚ï¼šæ˜Ÿå®‡" onchange="appData.flights.inbound.airline=this.value"></div>
                        <div style="flex:1"><label>èˆªç­è™Ÿç¢¼</label><input type="text" id="fl-in-no" placeholder="å¦‚ï¼šJX742" onchange="appData.flights.inbound.flightNo=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>æ—¥æœŸ</label><input type="date" id="fl-in-date" onchange="appData.flights.inbound.date=this.value"></div>
                        <div style="flex:1"><label>èˆªå»ˆ</label><input type="text" id="fl-in-term" placeholder="å¦‚ï¼šT1" onchange="appData.flights.inbound.terminal=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>å‡ºç™¼æ™‚é–“</label><input type="time" id="fl-in-dep" onchange="appData.flights.inbound.depTime=this.value"></div>
                        <div style="flex:1"><label>åˆ°é”æ™‚é–“</label><input type="time" id="fl-in-arr" onchange="appData.flights.inbound.arrTime=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>ç™»æ©Ÿæ™‚é–“</label><input type="time" id="fl-in-board" onchange="appData.flights.inbound.boardingTime=this.value"></div>
                        <div style="flex:1"><label>ç™»æ©Ÿé–€</label><input type="text" id="fl-in-gate" placeholder="å¦‚ï¼šC4" onchange="appData.flights.inbound.gate=this.value"></div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>è¨‚ä½ä»£ç¢¼ PNR</label><input type="text" id="fl-in-pnr" onchange="appData.flights.inbound.pnr=this.value"></div>
                        <div style="flex:1"><label>ç¥¨åƒ¹</label><input type="text" id="fl-in-fare" placeholder="å¦‚ï¼š$12,000" onchange="appData.flights.inbound.fare=this.value"></div>
                    </div>
                    <label>ğŸ‘¥ ä¹˜å®¢åå–®èˆ‡åº§ä½</label>
                    <div id="fl-in-passengers"></div>
                    <button class="outline full-width" onclick="addPassenger('inbound')" style="margin-top:10px;">+ æ–°å¢ä¹˜å®¢</button>
                </div>
                
                <button onclick="saveData('flights')" class="full-width">ğŸ’¾ å„²å­˜èˆªç­è³‡è¨Š</button>
            </div>
        </div>
    </div>
    
    <div id="page-hotel" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('hotel')" id="btn-edit-hotel">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
            <div id="view-hotel"></div>
            <div id="edit-hotel" style="display:none;">
                <div id="hotel-form-container"></div>
                <button class="secondary full-width" onclick="addHotel()">+ æ–°å¢ä¸‹ä¸€é–“é£¯åº—</button>
                <button onclick="saveData('hotel')" class="full-width">ğŸ’¾ å„²å­˜é£¯åº—è³‡è¨Š</button>
            </div>
        </div>
    </div>

    <div id="page-itinerary" class="page active">
        <div class="edit-controls"><button onclick="toggleEdit('itinerary')" id="btn-edit-itinerary">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
        <div id="itinerary-tabs" class="date-tabs-container"></div>
        <div id="view-itinerary"></div>
        <div id="edit-itinerary" style="display:none;">
            <div id="itinerary-form-container"></div>
            <button class="secondary full-width" onclick="addDay()">+ æ–°å¢ä¸€å¤©</button>
            <button onclick="saveData('itinerary')" class="full-width">ğŸ’¾ å„²å­˜æ‰€æœ‰è¡Œç¨‹</button>
        </div>
    </div>

    <div id="page-mrt" class="page">
        <div class="card">
            <h3>ğŸš‡ æ›¼è°·æ·é‹åœ–</h3>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomMap(-25)">ï¼</button>
                <button class="zoom-btn reset" onclick="zoomMap(0)">é‡ç½®</button>
                <button class="zoom-btn" onclick="zoomMap(25)">ï¼‹</button>
            </div>
            <div id="mrt-container">
                <img id="mrt-img" src="bangkok_mrt_2025.png" alt="MRT Map" style="width: 100%; transition: width 0.3s ease;">
            </div>
        </div>
    </div>
    
    <div id="page-tickets" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('tickets')" id="btn-edit-tickets">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
            <div id="view-tickets"></div>
            <div id="edit-tickets" style="display:none;">
                <div id="tickets-form-container"></div>
                <button class="secondary full-width" onclick="addTicket()">+ æ–°å¢ç¥¨åˆ¸</button>
                <button onclick="saveData('tickets')" class="full-width">ğŸ’¾ å„²å­˜ç¥¨åˆ¸</button>
            </div>
        </div>
    </div>

    <div id="page-translate" class="page">
        <div class="card">
            <h3>ğŸ‡¹ğŸ‡­ ç¿»è­¯å°å¹«æ‰‹</h3>
            <div class="trans-box"><label>ä¸­æ–‡ (ZH)</label><textarea id="trans-input" placeholder="è¼¸å…¥ä¸­æ–‡..."></textarea><button class="outline" onclick="speak('zh-TW', 'trans-input')">ğŸ”Š æ’­æ”¾ä¸­æ–‡</button></div>
            <div style="text-align:center; margin: 15px 0;"><button onclick="mockTranslate()">â¬‡ï¸ è·³è½‰ Google ç¿»è­¯ â¬‡ï¸</button></div>
            <div class="trans-box" style="background:#E1F5FE;"><label>æ³°æ–‡ (TH)</label><textarea id="trans-output" placeholder="é»æ“ŠæŒ‰éˆ•ç¿»è­¯..."></textarea><button class="outline" onclick="speak('th-TH', 'trans-output')">ğŸ”Š æ’­æ”¾æ³°æ–‡</button></div>
        </div>
    </div>
    
    <div id="page-phrases" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('phrases')" id="btn-edit-phrases">âœï¸ ç®¡ç†</button></div>
            <h3 style="color:var(--primary-dark); margin-top:0;"> æ—…éŠå¸¸ç”¨æ³°èª</h3>
            <div id="view-phrases"></div>
            <div id="edit-phrases" style="display:none;">
                <div id="phrases-form"></div>
                <button class="secondary full-width" onclick="addPhrase()">+ æ–°å¢å¥å‹</button>
                <button onclick="saveData('phrases')" class="full-width">ğŸ’¾ å„²å­˜</button>
            </div>
        </div>
    </div>

    <div id="page-shopping" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('shopping')" id="btn-edit-shopping">âœï¸ ç·¨è¼¯æ¨¡å¼</button></div>
            <div id="shopping-tabs" class="date-tabs-container"></div>
            <div id="view-shopping"></div>
            <div id="edit-shopping" style="display:none;">
                <div id="shopping-form"></div>
                <button class="secondary full-width" onclick="addShoppingItem()">+ æ–°å¢å¿…è²· (ç•¶å‰åˆ†é¡)</button>
                <button onclick="saveData('shopping')" class="full-width">ğŸ’¾ å„²å­˜æ¸…å–®</button>
            </div>
        </div>
    </div>
    
    <div id="page-notes" class="page">
        <div class="card">
            <div class="edit-controls"><button onclick="toggleEdit('notes')" id="btn-edit-notes">âœï¸ å¯«ç­†è¨˜</button></div>
            <div id="view-notes"></div>
            <div id="edit-notes" style="display:none;">
                <div id="notes-form"></div>
                <button class="secondary full-width" onclick="addNote()">+ æ–°å¢ç­†è¨˜</button>
                <button onclick="saveData('notes')" class="full-width">ğŸ’¾ å„²å­˜ç­†è¨˜</button>
            </div>
        </div>
    </div>
  
    <div id="page-emergency" class="page">
        <div class="card emergency-section" style="border-left: 5px solid #FF7043;">
            <h3 style="color:#D84315; margin-top:0;">ğŸ†˜ æ€¥é›£æ•‘åŠ©</h3>

            <h4 style="color:var(--primary-dark); margin-bottom:5px;">ã€Šå°ç£å¤–äº¤éƒ¨ã€‹</h4>
            <p style="margin-top:0;">æ€¥é›£æ•‘åŠ©å°ˆç·šï¼ˆæµ·å¤–ç›´æ’¥ï¼‰ï¼š<br><a href="tel:080008509" style="font-size:1.1rem; font-weight:bold; color:#0277BD; text-decoration:none;">0800-085-09</a></p>

            <h4 style="color:var(--primary-dark); margin-bottom:5px;">ã€Šé§æ³°åœ‹å°åŒ—ç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ã€‹</h4>
            <p style="margin-top:0; margin-bottom:8px;">ç·Šæ€¥é›»è©±ï¼ˆéä¸Šç­æ™‚é–“ï¼‰ï¼š<br><a href="tel:+66816664006" style="font-size:1.1rem; font-weight:bold; color:red; text-decoration:none;">+66-81-6664006</a></p>
            <p style="margin-top:0; margin-bottom:8px;">è¾¦å…¬å®¤é›»è©±ï¼ˆä¸Šç­æ™‚é–“ï¼‰ï¼š<br><a href="tel:+6621193555" style="font-weight:bold; color:#0277BD; text-decoration:none;">+66-2-119-3555</a></p>
            <p style="margin-top:0;">é›»å­éƒµä»¶ï¼š<br><a href="mailto:tha@mofa.gov.tw" style="color:#0277BD;">tha@mofa.gov.tw</a></p>

            <h4 style="color:var(--primary-dark); margin-bottom:5px;">ã€Šæ³°åœ‹ç•¶åœ°ç·Šæ€¥é›»è©±ã€‹</h4>
            <p style="margin-top:0; margin-bottom:5px;">è§€å…‰è­¦å¯Ÿï¼š<a href="tel:1155" style="font-weight:bold; color:red; text-decoration:none;">1155</a> <span style="font-size:0.9rem; color:#666;">(ä¸­æ–‡æœå‹™)</span></p>
            <p style="margin-top:0; margin-bottom:5px;">é†«ç™‚æ€¥æ•‘ä¸­å¿ƒï¼š<a href="tel:1669" style="font-weight:bold; color:red; text-decoration:none;">1669</a> æˆ– <a href="tel:1554" style="font-weight:bold; color:red; text-decoration:none;">1554</a></p>
            <p style="margin-top:0;">æ¶ˆè²»è€…ä¿è­·è¾¦å…¬å®¤ï¼š<a href="tel:1166" style="font-weight:bold; color:#0277BD; text-decoration:none;">1166</a></p>

            <div style="background:#FFF3E0; padding:12px; font-size:0.9rem; border-radius:10px; margin-top:15px; color:#D84315; border:1px solid #FFE0B2; line-height:1.5;">
                <b>âš ï¸ æ€¥é›£æ•‘åŠ©å°ˆç·šåƒ…é™ç·Šæ€¥æƒ…æ³ï¼ˆè»Šç¦ã€æ¶åŠ«ã€ç”Ÿå‘½å®‰å±ï¼‰ã€‚</b><br>ä¸€èˆ¬å•é¡Œè«‹æ–¼ä¸Šç­æ™‚é–“è¯ç¹«è¾¦äº‹è™•ã€‚
            </div>

            <h4 style="color:var(--primary-dark); margin-bottom:5px; margin-top:15px;">ã€ŠLINEå¸³è™Ÿã€‹</h4>
            <p style="margin-top:0;">ä¿å¹³å®‰æœå‹™å°ˆç·š LINE ID:<br><strong style="font-size:1.1rem; color:#4CAF50;">@Taiwan119</strong></p>
        </div>

        <div class="card transfer-box">
            <h3 style="color:#fff;">ğŸ”„ JSON å‚™ä»½èˆ‡é‚„åŸ</h3>
            <div style="display:flex; gap:10px;">
                <button class="secondary" onclick="exportJSON()" style="flex:1;">ğŸ“¤ åŒ¯å‡º</button>
                <button class="success" onclick="document.getElementById('import-file').click()" style="flex:1;">ğŸ“¥ åŒ¯å…¥</button>
            </div>
            <input type="file" id="import-file" style="display: none;" accept=".json" onchange="handleFileImport(this)">
        </div>

        <div style="text-align:center; margin-top:20px;"><button onclick="resetApp()" class="danger" style="opacity:0.6;">âš ï¸ é‡ç½®è³‡æ–™</button></div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item" onclick="switchPage('flights', this)" data-page="flights"><img src="airplane.png" class="nav-icon-img" alt="èˆªç­"><span>èˆªç­</span></div>
    <div class="nav-item" onclick="switchPage('hotel', this)" data-page="hotel"><img src="hotel.png" class="nav-icon-img" alt="é£¯åº—"><span>é£¯åº—</span></div>
    <div class="nav-item active" onclick="switchPage('itinerary', this)" data-page="itinerary"><img src="liti.png" class="nav-icon-img" alt="è¡Œç¨‹"><span>è¡Œç¨‹</span></div>
    <div class="nav-item" onclick="switchPage('mrt', this)" data-page="mrt"><img src="train.png" class="nav-icon-img" alt="æ·é‹"><span>æ·é‹</span></div>
    <div class="nav-item" onclick="switchPage('tickets', this)" data-page="tickets"><img src="ticket.png" class="nav-icon-img" alt="ç¥¨åˆ¸"><span>ç¥¨åˆ¸</span></div>
    <div class="nav-item" onclick="switchPage('translate', this)" data-page="translate"><img src="man.png" class="nav-icon-img" alt="ç¿»è­¯"><span>ç¿»è­¯</span></div>
    <div class="nav-item" onclick="switchPage('phrases', this)" data-page="phrases"><img src="TH flag.png" class="nav-icon-img" alt="æ³°æ–‡"><span>æ³°æ–‡</span></div>
    <div class="nav-item" onclick="switchPage('shopping', this)" data-page="shopping"><img src="shoppingbag.png" class="nav-icon-img" alt="å¿…è²·"><span>å¿…è²·</span></div>
    <div class="nav-item" onclick="switchPage('notes', this)" data-page="notes"><img src="note.png" class="nav-icon-img" alt="ç­†è¨˜"><span>ç­†è¨˜</span></div>
    <div class="nav-item" onclick="switchPage('emergency', this)" data-page="emergency"><img src="SOS.png" class="nav-icon-img" alt="æ±‚åŠ©"><span>æ±‚åŠ©</span></div>
</nav>

<script>
    const STORAGE_KEY = 'TravelApp_2026_V29_Final';
    
    const AUDIO_FILES = { pages: { flights: 'flights.mp3', hotel: 'hotel.mp3', itinerary: 'itinerary.mp3', mrt: 'mrt.mp3', tickets: 'tickets.mp3', translate: 'translate.mp3', phrases: 'phrases.mp3', shopping: 'shopping.mp3', notes: 'notes.mp3', emergency: 'emergency.mp3' } };
    
    // ğŸ‡¹ğŸ‡­ å…§å»º 50 å¥åˆ†é¡å¥½çš„è§€å…‰å¯¦ç”¨æ³°æ–‡
    const defaultPhrases = [
        {category: "å•å€™", zh: "ä½ å¥½", th: "à¸ªà¸§à¸±à¸ªà¸”à¸µ"}, {category: "å•å€™", zh: "è¬è¬", th: "à¸‚à¸­à¸šà¸„à¸¸à¸“"}, {category: "å•å€™", zh: "å°ä¸èµ· / ä¸å¥½æ„æ€", th: "à¸‚à¸­à¹‚à¸—à¸©"}, {category: "å•å€™", zh: "æ²’é—œä¿‚", th: "à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™à¹„à¸£"}, {category: "å•å€™", zh: "å†è¦‹", th: "à¸¥à¸²à¸à¹ˆà¸­à¸™"}, {category: "å•å€™", zh: "é€™æ˜¯ä»€éº¼ï¼Ÿ", th: "à¸™à¸µà¹ˆà¸„à¸·à¸­à¸­à¸°à¹„à¸£?"}, {category: "å•å€™", zh: "è«‹å•...", th: "à¸‚à¸­à¸–à¸²à¸¡à¸«à¸™à¹ˆà¸­à¸¢..."}, {category: "å•å€™", zh: "å¾ˆé«˜èˆˆèªè­˜ä½ ", th: "à¸¢à¸´à¸™à¸”à¸µà¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸¹à¹‰à¸ˆà¸±à¸"}, {category: "å•å€™", zh: "ç¥ä½ å¥½é‹", th: "à¸‚à¸­à¹ƒà¸«à¹‰à¹‚à¸Šà¸„à¸”à¸µ"}, {category: "å•å€™", zh: "æ™šå®‰", th: "à¸£à¸²à¸•à¸£à¸µà¸ªà¸§à¸±à¸ªà¸”à¸´à¹Œ"},
        {category: "è³¼ç‰©", zh: "å¤šå°‘éŒ¢ï¼Ÿ", th: "à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ?"}, {category: "è³¼ç‰©", zh: "å¤ªè²´äº†", th: "à¹à¸à¸‡à¹„à¸›"}, {category: "è³¼ç‰©", zh: "å¯ä»¥ä¾¿å®œä¸€é»å—ï¼Ÿ", th: "à¸¥à¸”à¸«à¸™à¹ˆà¸­à¸¢à¹„à¸”à¹‰à¹„à¸«à¸¡?"}, {category: "è³¼ç‰©", zh: "æˆ‘è¦é€™å€‹", th: "à¹€à¸­à¸²à¸­à¸±à¸™à¸™à¸µà¹‰"}, {category: "è³¼ç‰©", zh: "æœ‰å…¶ä»–é¡è‰²å—ï¼Ÿ", th: "à¸¡à¸µà¸ªà¸µà¸­à¸·à¹ˆà¸™à¹„à¸«à¸¡?"}, {category: "è³¼ç‰©", zh: "è«‹å•å¯ä»¥è©¦ç©¿å—ï¼Ÿ", th: "à¸‚à¸­à¸¥à¸­à¸‡à¹„à¸”à¹‰à¹„à¸«à¸¡?"}, {category: "è³¼ç‰©", zh: "æœ‰å¤§ä¸€é»çš„å—ï¼Ÿ", th: "à¸¡à¸µà¹ƒà¸«à¸à¹ˆà¸à¸§à¹ˆà¸²à¸™à¸µà¹‰à¹„à¸«à¸¡?"}, {category: "è³¼ç‰©", zh: "æœ‰å°ä¸€é»çš„å—ï¼Ÿ", th: "à¸¡à¸µà¹€à¸¥à¹‡à¸à¸à¸§à¹ˆà¸²à¸™à¸µà¹‰à¹„à¸«à¸¡?"}, {category: "è³¼ç‰©", zh: "æˆ‘ä¸è¦", th: "à¹„à¸¡à¹ˆà¹€à¸­à¸²"}, {category: "è³¼ç‰©", zh: "çµå¸³", th: "à¹€à¸à¹‡à¸šà¸•à¸±à¸‡à¸„à¹Œ"},
        {category: "é£²é£Ÿ", zh: "å¾ˆå¥½åƒ", th: "à¸­à¸£à¹ˆà¸­à¸¢à¸¡à¸²à¸"}, {category: "é£²é£Ÿ", zh: "ä¸åŠ è¾£", th: "à¹„à¸¡à¹ˆà¹€à¸œà¹‡à¸”"}, {category: "é£²é£Ÿ", zh: "çµå¸³ / è²·å–®", th: "à¹€à¸Šà¹‡à¸„à¸šà¸´à¸¥"}, {category: "é£²é£Ÿ", zh: "è«‹å•æœ‰ä¸­æ–‡èœå–®å—ï¼Ÿ", th: "à¸¡à¸µà¹€à¸¡à¸™à¸¹à¸ à¸²à¸©à¸²à¸ˆà¸µà¸™à¹„à¸«à¸¡?"}, {category: "é£²é£Ÿ", zh: "å¹¾ä½ï¼Ÿ", th: "à¸à¸µà¹ˆà¸—à¹ˆà¸²à¸™?"}, {category: "é£²é£Ÿ", zh: "å…©ä½", th: "à¸ªà¸­à¸‡à¸—à¹ˆà¸²à¸™"}, {category: "é£²é£Ÿ", zh: "æˆ‘è¦å–æ°´", th: "à¸‚à¸­à¸™à¹‰à¸³à¹€à¸›à¸¥à¹ˆà¸²"}, {category: "é£²é£Ÿ", zh: "æ¨è–¦ä»€éº¼èœï¼Ÿ", th: "à¸¡à¸µà¹€à¸¡à¸™à¸¹à¹à¸™à¸°à¸™à¸³à¹„à¸«à¸¡?"}, {category: "é£²é£Ÿ", zh: "å¤ªè¾£äº†", th: "à¹€à¸œà¹‡à¸”à¹„à¸›"}, {category: "é£²é£Ÿ", zh: "å¤–å¸¶", th: "à¸à¸¥à¸±à¸šà¸šà¹‰à¸²à¸™"},
        {category: "äº¤é€š", zh: "å»é€™è£¡", th: "à¹„à¸›à¸—à¸µà¹ˆà¸™à¸µà¹ˆ"}, {category: "äº¤é€š", zh: "è«‹å•å»æ‰€åœ¨å“ªè£¡ï¼Ÿ", th: "à¸«à¹‰à¸­à¸‡à¸™à¹‰à¸³à¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸™?"}, {category: "äº¤é€š", zh: "å·¦è½‰", th: "à¹€à¸¥à¸µà¹‰à¸¢à¸§à¸‹à¹‰à¸²à¸¢"}, {category: "äº¤é€š", zh: "å³è½‰", th: "à¹€à¸¥à¸µà¹‰à¸¢à¸§à¸‚à¸§à¸²"}, {category: "äº¤é€š", zh: "ç›´èµ°", th: "à¸•à¸£à¸‡à¹„à¸›"}, {category: "äº¤é€š", zh: "åœé€™è£¡", th: "à¸ˆà¸­à¸”à¸—à¸µà¹ˆà¸™à¸µà¹ˆ"}, {category: "äº¤é€š", zh: "åˆ°æ©Ÿå ´", th: "à¹„à¸›à¸ªà¸™à¸²à¸¡à¸šà¸´à¸™"}, {category: "äº¤é€š", zh: "æ·é‹ç«™æ€éº¼èµ°ï¼Ÿ", th: "à¸ªà¸–à¸²à¸™à¸µà¸£à¸–à¹„à¸Ÿà¸Ÿà¹‰à¸²à¹„à¸›à¸—à¸²à¸‡à¹„à¸«à¸™?"}, {category: "äº¤é€š", zh: "è¨ˆç¨‹è»Š", th: "à¹à¸—à¹‡à¸à¸‹à¸µà¹ˆ"}, {category: "äº¤é€š", zh: "è«‹å•è¦å¤šä¹…ï¼Ÿ", th: "à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸™à¸²à¸™à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ?"},
        {category: "æ±‚åŠ©", zh: "æ•‘å‘½ï¼", th: "à¸Šà¹ˆà¸§à¸¢à¸”à¹‰à¸§à¸¢!"}, {category: "æ±‚åŠ©", zh: "æˆ‘è¿·è·¯äº†", th: "à¸‰à¸±à¸™à¸«à¸¥à¸‡à¸—à¸²à¸‡"}, {category: "æ±‚åŠ©", zh: "è­¦å¯Ÿå±€åœ¨å“ªè£¡ï¼Ÿ", th: "à¸ªà¸–à¸²à¸™à¸µà¸•à¸³à¸£à¸§à¸ˆà¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸™?"}, {category: "æ±‚åŠ©", zh: "é†«é™¢åœ¨å“ªè£¡ï¼Ÿ", th: "à¹‚à¸£à¸‡à¸à¸¢à¸²à¸šà¸²à¸¥à¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸™?"}, {category: "æ±‚åŠ©", zh: "æˆ‘çš„éŒ¢åŒ…ä¸è¦‹äº†", th: "à¸à¸£à¸°à¹€à¸›à¹‹à¸²à¸•à¸±à¸‡à¸„à¹Œà¸«à¸²à¸¢"}, {category: "æ±‚åŠ©", zh: "è«‹å¹«å¹«æˆ‘", th: "à¸Šà¹ˆà¸§à¸¢à¸‰à¸±à¸™à¸«à¸™à¹ˆà¸­à¸¢"}, {category: "æ±‚åŠ©", zh: "æˆ‘éœ€è¦æœƒèªªä¸­æ–‡çš„äºº", th: "à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸„à¸™à¸—à¸µà¹ˆà¸à¸¹à¸”à¸ à¸²à¸©à¸²à¸ˆà¸µà¸™à¹„à¸”à¹‰"}, {category: "æ±‚åŠ©", zh: "åœä¸‹ä¾†ï¼", th: "à¸«à¸¢à¸¸à¸”!"}, {category: "æ±‚åŠ©", zh: "æœƒç—›", th: "à¹€à¸ˆà¹‡à¸š"}, {category: "æ±‚åŠ©", zh: "æ‰“é›»è©±çµ¦å¤§ä½¿é¤¨", th: "à¹‚à¸—à¸£à¸«à¸²à¸ªà¸–à¸²à¸™à¸—à¸¹à¸•"}
    ];

    const defaultData = {
        flights: { outbound: { passengers:[] }, inbound: { passengers:[] } },
        hotels: [
            { name: 'Grande Centre Point Lumphini', checkIn: '2026-03-04', checkOut: '2026-03-07', envPhoto: '' },
            { name: 'Ascott Thonglor Bangkok', checkIn: '2026-03-07', checkOut: '2026-03-10', envPhoto: '' }
        ],
        itinerary: [
            { date: '2026-03-04', summary: 'æŠµé”æ›¼è°·', items: [] },
            { date: '2026-03-05', summary: 'è¦ªå­åŒæ¨‚', items: [{ time: '10:00', title: 'Meland Park (ä½æ–¼ Siam Paragon)', transport:'BTS Siamç«™', hours:'10:00-22:00', recommend:'', notes: 'å®¤å…§è¡Œç¨‹ï¼Œé©åˆæ—©ä¸Šæ”¾é›»' }]}
        ],
        tickets: [], phrases: defaultPhrases, shopping: [], notes: []
    };

    let appData;
    try {
        const stored = localStorage.getItem(STORAGE_KEY);
        appData = stored ? JSON.parse(stored) : defaultData;
    } catch(e) { appData = defaultData; }
    
    // ç¢ºä¿èˆŠè³‡æ–™å‡ç´š
    if(!appData.itinerary) appData.itinerary = defaultData.itinerary;
    if(!appData.shopping) appData.shopping = [];
    if(!appData.notes) appData.notes = [];
    if(!appData.tickets) appData.tickets = [];
    if(!appData.flights) appData.flights = defaultData.flights;
    if(!appData.flights.outbound.passengers) appData.flights.outbound.passengers = [];
    if(!appData.flights.inbound.passengers) appData.flights.inbound.passengers = [];
    if(!appData.hotels) appData.hotels = defaultData.hotels;
    
    // å¼·åˆ¶å¯«å…¥ 50 å¥æ³°æ–‡è³‡æ–™ (è‹¥åŸè³‡æ–™çŸ­ç¼º)
    if(!appData.phrases || appData.phrases.length < 50) appData.phrases = defaultPhrases;

    let currentItineraryDayIndex = 0;
    let currentShoppingCategory = 'å…¨éƒ¨';

    function initAudio() {
        window.speechSynthesis.getVoices();
        
        const audioClick = document.getElementById('audio-click');
        const audioPage = document.getElementById('audio-page-effect');
        document.addEventListener('click', (e) => {
            if (e.target.id === 'start-btn' || e.target.closest('button.outline') || e.target.classList.contains('outline')) return;
            const navItem = e.target.closest('.nav-item');
            if (navItem) {
                const pageId = navItem.getAttribute('data-page');
                const soundFile = AUDIO_FILES.pages[pageId];
                if (soundFile && audioPage) { audioPage.src = soundFile; audioPage.play().catch(()=>{}); } 
                else if (audioClick) { const clone = audioClick.cloneNode(); clone.volume = 0.5; clone.play().catch(()=>{}); }
            }
        });
    }

    // å¼·åŒ–ç‰ˆèªéŸ³æ’­æ”¾åŠŸèƒ½
    function playAudioText(text, lang) {
        if (!text) return;
        window.speechSynthesis.cancel();
        
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = lang; 
        msg.rate = 0.85; 
        msg.pitch = 1.0;
        
        const voices = window.speechSynthesis.getVoices();
        if (voices.length > 0) {
            const targetVoice = voices.find(v => v.lang.replace('_', '-').toLowerCase().includes(lang.toLowerCase()) && (v.name.includes('Premium') || v.name.includes('Google')));
            const fallbackVoice = voices.find(v => v.lang.replace('_', '-').toLowerCase().includes(lang.toLowerCase()));
            if (targetVoice) msg.voice = targetVoice;
            else if (fallbackVoice) msg.voice = fallbackVoice;
        }
        window.speechSynthesis.speak(msg);
    }

    function speak(lang, id) { 
        const text = document.getElementById(id).value;
        playAudioText(text, lang); 
    }

    function startApp() {
        const screen = document.getElementById('splash-screen');
        if(screen) { screen.style.opacity = '0'; setTimeout(() => screen.style.display = 'none', 800); }
        const audioOpening = document.getElementById('audio-opening');
        const audioBGM = document.getElementById('audio-bgm');
        if(audioOpening) audioOpening.play().catch(()=>{});
        if(audioBGM) { audioBGM.volume = 0.3; audioBGM.play().catch(()=>{}); }
    }

    function switchPage(pageId, navEl) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        navEl.classList.add('active');
        renderView(pageId);
    }

    function toggleEdit(section) {
        const v = document.getElementById(`view-${section}`);
        const e = document.getElementById(`edit-${section}`);
        const btn = document.getElementById(`btn-edit-${section}`);
        if(e.style.display === 'none') { e.style.display = 'block'; v.style.display = 'none'; btn.innerText = 'ğŸ‘€ è¿”å›ç€è¦½'; } 
        else { e.style.display = 'none'; v.style.display = 'block'; btn.innerText = 'âœï¸ ç·¨è¼¯æ¨¡å¼'; }
        renderView(section);
    }

    function saveToLocal() { localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); }
    function saveData(section) { saveToLocal(); showToast('âœ¨ å„²å­˜æˆåŠŸ'); toggleEdit(section); }
    function showToast(msg) {
        const t = document.createElement('div'); t.className = 'toast'; t.innerText = msg;
        document.getElementById('toast-container').appendChild(t);
        setTimeout(() => { t.style.opacity='0'; setTimeout(()=>t.remove(),500); }, 2000);
    }

    // --- HTML ç”Ÿæˆå™¨ ---
    function renderPassengerList(type) {
        const list = appData.flights[type].passengers;
        if(list.length === 0) return '<div style="color:#888; font-size:0.9rem;">å°šæœªæ–°å¢ä¹˜å®¢</div>';
        return list.map((p, idx) => `
            <div style="display:flex; gap:10px; margin-bottom:5px; align-items:center;">
                <input style="margin:0; flex:2;" placeholder="å§“å" value="${p.name}" onchange="appData.flights['${type}'].passengers[${idx}].name=this.value">
                <input style="margin:0; flex:1;" placeholder="åº§ä½" value="${p.seat}" onchange="appData.flights['${type}'].passengers[${idx}].seat=this.value">
                <button class="danger icon-btn" style="padding:6px 10px;" onclick="removePassenger('${type}', ${idx})">ğŸ—‘ï¸</button>
            </div>
        `).join('');
    }

    function getFlightViewHTML(f, title, icon, color) {
        if(!f.airline && !f.flightNo) return `<div class="card" style="text-align:center; color:#888;">å°šæœªè¨­å®š${title}èˆªç­</div>`;
        return `
            <div class="card" style="border-top: 5px solid ${color};">
                <h3 style="margin-top:0; color:${color};">${icon} ${title}</h3>
                <div style="background:#f5f5f5; padding:12px; border-radius:10px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                    <b style="font-size:1.2rem; color:var(--primary-dark);">${f.airline || ''} ${f.flightNo || ''}</b> 
                    <span style="background:white; padding:4px 8px; border-radius:5px; border:1px solid #ddd; font-size:0.9rem;">èˆªå»ˆ <b>${f.terminal || '-'}</b></span>
                </div>
                <div class="info-row"><span class="info-label">æ—¥æœŸ</span><span class="info-value">${f.date || '-'}</span></div>
                <div class="info-row"><span class="info-label">æ™‚é–“</span><span class="info-value" style="font-weight:bold;">${f.depTime || '-'} â¡ï¸ ${f.arrTime || '-'}</span></div>
                <div class="info-row"><span class="info-label">ç™»æ©Ÿ</span><span class="info-value"><span style="color:#FF7043; font-weight:bold;">${f.boardingTime || '-'}</span> (ç™»æ©Ÿé–€: ${f.gate || '-'})</span></div>
                <div class="info-row"><span class="info-label">PNRä»£ç¢¼</span><span class="info-value" style="font-family:monospace; font-size:1.1rem; letter-spacing:1px;">${f.pnr || '-'}</span></div>
                <div class="info-row"><span class="info-label">ç¥¨åƒ¹</span><span class="info-value">${f.fare || '-'}</span></div>
                ${f.passengers.length > 0 ? `
                    <div style="margin-top:15px; background:#E0F7FA; padding:10px; border-radius:10px;">
                        <b style="color:var(--primary-dark); display:block; margin-bottom:8px;">ğŸ‘¥ ä¹˜å®¢åº§ä½</b>
                        ${f.passengers.map(p => `<div style="display:flex; justify-content:space-between; border-bottom:1px dashed #B2EBF2; padding:4px 0;"><span>${p.name || 'æœªå‘½å'}</span><b style="color:#0277BD;">${p.seat || 'æœªåŠƒä½'}</b></div>`).join('')}
                    </div>` : ''}
            </div>`;
    }

    // 4. æ¸²æŸ“å¼•æ“
    const renderers = {
        itinerary: () => {
            const tabs = document.getElementById('itinerary-tabs');
            tabs.innerHTML = appData.itinerary.map((d, i) => `<div class="date-tab ${i===currentItineraryDayIndex?'active':''}" onclick="switchItineraryDay(${i})">Day ${i+1}<br><small>${d.date||'æœªå®š'}</small></div>`).join('');
            
            const day = appData.itinerary[currentItineraryDayIndex];
            const dIdx = currentItineraryDayIndex;
            
            // æª¢è¦–æ¨¡å¼
            document.getElementById('view-itinerary').innerHTML = day ? `
                <div style="background-color: #FFF9C4; color: #F57F17; padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; font-size:1.1rem; margin-bottom: 20px; border: 2px dashed #FBC02D; box-shadow: 0 4px 10px rgba(245, 127, 23, 0.1);">
                    ğŸŒŸ ç•¶æ—¥ä¸»é¡Œï¼š${day.summary || 'æœªè¨­å®šä¸»é¡Œ'}
                </div>
                ${day.items.map(i => {
                    const mapBtn = i.link 
                        ? `<a href="${i.link}" target="_blank" class="outline" style="display:inline-block; padding:6px 15px; text-decoration:none; border-radius:15px; margin-top:10px;">ğŸ”— é–‹å•Ÿé€£çµ</a>`
                        : `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i.title || '')}" target="_blank" class="outline" style="display:inline-block; padding:6px 15px; text-decoration:none; border-radius:15px; margin-top:10px;">ğŸ” æœåœ°åœ–</a>`;

                    return `
                    <div class="timeline-item">
                        <div style="background: #E1F5FE; padding: 10px 15px; border-radius: 10px; font-weight: bold; color: var(--primary-dark); margin-bottom: 8px; border-left: 4px solid var(--primary-color);">
                            â° ${i.time || 'æœªå®šæ™‚'} - ${i.title || 'æœªå‘½åè¡Œç¨‹'}
                        </div>
                        <div class="detail-card">
                            ${i.transport ? `<div style="margin-bottom:5px;"><b>ğŸš• äº¤é€šï¼š</b>${i.transport}</div>` : ''}
                            ${i.hours ? `<div style="margin-bottom:5px;"><b>â±ï¸ ç‡Ÿæ¥­ï¼š</b>${i.hours}</div>` : ''}
                            ${i.recommend ? `<div style="margin-bottom:5px;"><b>â­ å¿…è²·/æ¨è–¦ï¼š</b>${i.recommend}</div>` : ''}
                            ${i.notes ? `<div style="color:#666; white-space: pre-wrap; margin-top:8px; padding-top:8px; border-top:1px dashed #eee;">ğŸ“ ${i.notes}</div>` : ''}
                            ${i.photo ? `<img src="${i.photo}" class="auto-img" style="margin-top:10px;">` : ''}
                            ${mapBtn}
                        </div>
                    </div>`
                }).join('')}` : '<div style="text-align:center; padding:20px; color:#888;">è«‹é»æ“Šç·¨è¼¯æ–°å¢è¡Œç¨‹</div>';
            
            // ç·¨è¼¯æ¨¡å¼
            document.getElementById('itinerary-form-container').innerHTML = day ? `
                <div class="edit-group">
                    <button class="danger" style="float:right; padding:5px 10px; font-size:0.8rem;" onclick="removeDay(${dIdx})">ğŸ—‘ï¸ åˆªé™¤ Day ${dIdx+1}</button>
                    <label>æ—¥æœŸ</label><input type="date" value="${day.date}" onchange="appData.itinerary[${dIdx}].date=this.value; renderView('itinerary');">
                    <label>ç•¶æ—¥ä¸»é¡Œ ğŸŒŸ</label><input value="${day.summary}" placeholder="å¦‚ï¼šæ°´ä¸Šå¸‚å ´ä¸€æ—¥éŠ" onchange="appData.itinerary[${dIdx}].summary=this.value; renderView('itinerary');">
                    <hr style="border:1px dashed #ccc; margin:15px 0;">
                    ${day.items.map((itm, iIdx) => `
                        <details open style="margin-bottom:15px; background:#fff; border-radius:10px; border:2px solid #e0e0e0;">
                            <summary style="padding:12px; font-weight:bold; cursor:pointer; background:#f5f5f5; border-radius:10px 10px 0 0;">
                                ${itm.time || 'æ™‚é–“'} - ${itm.title || 'æ–°é …ç›®'} 
                                <span style="float:right;">
                                    <span class="move-btn" onclick="event.preventDefault(); moveItm(${dIdx}, ${iIdx}, -1)">â¬†ï¸</span>
                                    <span class="move-btn" onclick="event.preventDefault(); moveItm(${dIdx}, ${iIdx}, 1)">â¬‡ï¸</span>
                                </span>
                            </summary>
                            <div style="padding:15px;">
                                <div style="display:flex; gap:10px;">
                                    <div style="flex:1"><label>æ™‚é–“</label><input placeholder="å¦‚ 10:00" value="${itm.time||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].time=this.value"></div>
                                    <div style="flex:2"><label>æ¨™é¡Œ</label><input placeholder="è¡Œç¨‹åç¨±" value="${itm.title||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].title=this.value"></div>
                                </div>
                                <label>äº¤é€šæ–¹å¼</label><input placeholder="å¦‚ï¼šæ­ä¹˜ BTS åˆ° Siam ç«™" value="${itm.transport||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].transport=this.value">
                                <label>ç‡Ÿæ¥­æ™‚é–“</label><input placeholder="å¦‚ï¼š09:00 - 18:00" value="${itm.hours||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].hours=this.value">
                                <label>å¿…è²· / æ¨è–¦èœå–®</label><input placeholder="å¦‚ï¼šèŠ’æœç³¯ç±³é£¯" value="${itm.recommend||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].recommend=this.value">
                                <label>ç¶²ç«™ / åœ°åœ–é€£çµ (ç©ºç™½è‡ªå‹•æœåœ°åœ–)</label><input placeholder="https://..." value="${itm.link||''}" onchange="appData.itinerary[${dIdx}].items[${iIdx}].link=this.value">
                                <label>å‚™è¨»ç´°ç¯€</label><textarea rows="2" onchange="appData.itinerary[${dIdx}].items[${iIdx}].notes=this.value">${itm.notes||''}</textarea>
                                
                                <div style="margin-top:10px; border:1px solid #eee; padding:10px; border-radius:10px;">
                                    <label class="file-upload-btn">ğŸ“· é»æ“Šä¸Šå‚³æ™¯é»ç…§ç‰‡<input type="file" accept="image/*" style="display:none;" onchange="encodeItineraryImage(${dIdx}, ${iIdx}, this)"></label>
                                    ${itm.photo ? `<img src="${itm.photo}" class="auto-img" style="max-height:150px; object-fit:contain; margin:10px auto;"> <button class="outline full-width" style="padding:5px;" onclick="appData.itinerary[${dIdx}].items[${iIdx}].photo=''; renderView('itinerary');">ç§»é™¤ç…§ç‰‡</button>` : ''}
                                </div>
                                <button class="danger icon-btn full-width" style="margin-top:15px;" onclick="removeItm(${dIdx}, ${iIdx})">ğŸ—‘ï¸ åˆªé™¤æ­¤é …ç›®</button>
                            </div>
                        </details>`).join('')}
                    <button class="outline full-width" onclick="addItm(${dIdx})">+ æ–°å¢è¡Œç¨‹é …ç›®</button>
                </div>` : '';
        },
        tickets: () => {
            document.getElementById('view-tickets').innerHTML = appData.tickets.length === 0 
                ? '<div style="text-align:center; padding:20px; color:#888;">å°šæœªåŠ å…¥ä»»ä½•é›»å­ç¥¨åˆ¸</div>'
                : appData.tickets.map((t, i) => `
                <div class="card" style="border-left: 5px solid #AB47BC;">
                    <h3 style="margin-top:0; color:#8E24AA;">ğŸŸï¸ ${t.name || 'æœªå‘½åç¥¨åˆ¸'}</h3>
                    <div class="info-row"><span class="info-label">ä½¿ç”¨æ—¥æœŸ</span><span class="info-value" style="font-weight:bold;">${t.date || '-'}</span></div>
                    <div class="info-row"><span class="info-label">æ™‚é–“</span><span class="info-value">${t.time || '-'}</span></div>
                    <div class="info-row"><span class="info-label">åœ°é»</span><span class="info-value">${t.location || '-'}</span></div>
                    <div style="background:#F3E5F5; padding:10px; border-radius:10px; margin-top:10px; display:flex; justify-content:space-around;">
                        <div style="text-align:center;"><span style="font-size:0.8rem; color:#888;">æˆäººåƒ¹æ ¼</span><br><b style="color:#6A1B9A;">${t.priceAdult || '-'}</b></div>
                        <div style="text-align:center;"><span style="font-size:0.8rem; color:#888;">å…’ç«¥åƒ¹æ ¼</span><br><b style="color:#6A1B9A;">${t.priceChild || '-'}</b></div>
                    </div>
                    ${t.voucher ? `<div style="margin-top:15px; text-align:center; border-top:1px dashed #ccc; padding-top:10px;"><b style="color:#555; display:block; margin-bottom:10px;">ğŸ“± å…¥å ´æ†‘è­‰ (QR Code)</b><img src="${t.voucher}" class="auto-img" style="max-height:250px; margin:0 auto;"></div>` : ''}
                </div>`).join('');

            document.getElementById('tickets-form-container').innerHTML = appData.tickets.map((t, i) => `
                <div class="edit-group" style="border-left: 5px solid #AB47BC;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h4 style="margin:0; color:#8E24AA;">ğŸŸï¸ ç¥¨åˆ¸ ${i+1}</h4>
                        <div>
                            <span class="move-btn" onclick="moveTicket(${i}, -1)">â¬†ï¸</span> 
                            <span class="move-btn" onclick="moveTicket(${i}, 1)">â¬‡ï¸</span>
                        </div>
                    </div>
                    <label>ç¥¨åˆ¸åç¨±</label><input type="text" value="${t.name || ''}" placeholder="å¦‚ï¼šSafari World é–€ç¥¨" onchange="appData.tickets[${i}].name=this.value">
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>æ—¥æœŸ</label><input type="date" value="${t.date || ''}" onchange="appData.tickets[${i}].date=this.value"></div>
                        <div style="flex:1"><label>æ™‚é–“</label><input type="time" value="${t.time || ''}" onchange="appData.tickets[${i}].time=this.value"></div>
                    </div>
                    <label>ä½¿ç”¨åœ°é»</label><input type="text" value="${t.location || ''}" onchange="appData.tickets[${i}].location=this.value">
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>æˆäººåƒ¹æ ¼</label><input type="text" value="${t.priceAdult || ''}" placeholder="$" onchange="appData.tickets[${i}].priceAdult=this.value"></div>
                        <div style="flex:1"><label>å…’ç«¥åƒ¹æ ¼</label><input type="text" value="${t.priceChild || ''}" placeholder="$" onchange="appData.tickets[${i}].priceChild=this.value"></div>
                    </div>
                    
                    <div style="margin-top:15px; background:#fff; padding:10px; border-radius:10px; border:1px solid #ddd;">
                        <label>ğŸ“± é›»å­æ†‘è­‰ (QR Code)</label>
                        <label class="file-upload-btn">ğŸ“· é»æ“Šä¸Šå‚³<input type="file" accept="image/*" style="display:none;" onchange="encodeTicketImage(${i}, this)"></label>
                        ${t.voucher ? `<img src="${t.voucher}" class="auto-img" style="max-height:150px; object-fit:contain; margin:10px auto;"> <button class="outline full-width" style="padding:5px;" onclick="appData.tickets[${i}].voucher=''; renderView('tickets');">ç§»é™¤æ†‘è­‰</button>` : ''}
                    </div>
                    <button class="danger full-width" style="margin-top:15px;" onclick="removeTicket(${i})">ğŸ—‘ï¸ åˆªé™¤æ­¤ç¥¨åˆ¸</button>
                </div>
            `).join('');
        },
        phrases: () => {
            const grouped = {};
            appData.phrases.forEach((p, i) => {
                const cat = p.category || 'å…¶ä»–';
                if(!grouped[cat]) grouped[cat] = [];
                grouped[cat].push({ ...p, originalIndex: i });
            });

            let viewHtml = '';
            for(let cat in grouped) {
                viewHtml += `<h4 style="color:var(--primary-dark); margin-top:20px; border-bottom:2px solid #ddd; padding-bottom:5px;">ğŸ“Œ ${cat}</h4>`;
                viewHtml += grouped[cat].map(p => `
                    <div style="display:flex; justify-content:space-between; align-items:center; background:#fff; padding:12px; border-radius:15px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                        <div style="flex:1;">
                            <div style="font-weight:bold; font-size:1.1rem;">${p.zh}</div>
                            <div style="color:#0277BD; font-size:0.95rem; margin-top:3px;">${p.th}</div>
                        </div>
                        <button class="icon-btn outline" style="padding:8px 12px; font-size:1.2rem; border:2px solid var(--accent-color); background:#FFFDE7; box-shadow:0 2px 5px rgba(0,0,0,0.1);" onclick="playAudioText('${p.th}', 'th-TH')">ğŸ”Š</button>
                    </div>
                `).join('');
            }
            document.getElementById('view-phrases').innerHTML = viewHtml || '<div style="text-align:center; padding:20px; color:#888;">å°šæœªåŠ å…¥ä»»ä½•å¥å‹</div>';

            document.getElementById('phrases-form').innerHTML = appData.phrases.map((p, i) => `
                <div class="edit-group" style="padding:15px;">
                    <div style="text-align:right; margin-bottom:5px;">
                        <span class="move-btn" onclick="movePhrase(${i}, -1)">â¬†ï¸</span>
                        <span class="move-btn" onclick="movePhrase(${i}, 1)">â¬‡ï¸</span>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>åˆ†é¡</label><input value="${p.category||'å…¶ä»–'}" onchange="appData.phrases[${i}].category=this.value"></div>
                        <div style="flex:2"><label>ä¸­æ–‡</label><input value="${p.zh}" onchange="appData.phrases[${i}].zh=this.value"></div>
                    </div>
                    <label>æ³°æ–‡</label><input value="${p.th}" onchange="appData.phrases[${i}].th=this.value">
                    <button class="danger full-width" style="margin-top:10px;" onclick="removePhrase(${i})">ğŸ—‘ï¸ åˆªé™¤æ­¤å¥</button>
                </div>
            `).join('');
        },
        shopping: () => {
            const cats = Array.from(new Set(appData.shopping.map(s => s.category || 'æœªåˆ†é¡')));
            const tabs = ['å…¨éƒ¨', ...cats];
            document.getElementById('shopping-tabs').innerHTML = tabs.map(c => `<div class="date-tab ${c===currentShoppingCategory?'active':''}" onclick="switchShoppingTab('${c}')">${c}</div>`).join('');
            
            const filtered = appData.shopping.filter(s => currentShoppingCategory==='å…¨éƒ¨' || (s.category||'æœªåˆ†é¡')===currentShoppingCategory);
            
            document.getElementById('view-shopping').innerHTML = filtered.length === 0 ? '<div style="text-align:center; padding:20px; color:#888;">æ­¤åˆ†é¡æ²’æœ‰æ¸…å–®</div>' : filtered.map(s => {
                const globalIdx = appData.shopping.indexOf(s);
                return `
                <div class="shopping-item ${s.done?'checked':''}">
                    <div class="check-circle" onclick="toggleShop(${globalIdx})">${s.done?'âœ”':''}</div>
                    <div class="shop-details" style="flex:1; transition:0.3s;">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <b style="font-size:1.1rem;">${s.item||'æœªå‘½å'}</b>
                            <span style="background: #E1F5FE; color: var(--primary-dark); padding: 3px 8px; border-radius: 5px; font-size: 0.8rem; font-weight:bold;">ğŸ·ï¸ ${s.category||'æœªåˆ†é¡'}</span>
                        </div>
                        <div style="color:var(--primary-color); font-weight:bold; margin-top:5px;">${s.price ? `é ä¼°ï¼š${s.price}` : ''}</div>
                        ${s.location ? `<div style="font-size:0.85rem; color:#666; margin-top:3px;">ğŸ“ ${s.location}</div>` : ''}
                        ${s.notes ? `<div style="font-size:0.85rem; color:#888; margin-top:3px;">ğŸ“ ${s.notes}</div>` : ''}
                        ${s.link ? `<div style="margin-top:5px;"><a href="${s.link}" target="_blank" style="font-size:0.85rem; color:var(--primary-dark);">ğŸ”— åƒè€ƒç¶²å€</a></div>` : ''}
                        ${s.photo ? `<img src="${s.photo}" class="auto-img" style="margin-top:10px; max-height:150px; object-fit:contain;">` : ''}
                    </div>
                </div>`;
            }).join('');
            
            document.getElementById('shopping-form').innerHTML = filtered.map(s => {
                const globalIdx = appData.shopping.indexOf(s);
                return `<div class="edit-group" style="padding:15px;">
                    <div style="text-align:right; margin-bottom:5px;">
                        <span class="move-btn" onclick="moveShop(${globalIdx}, -1)">â¬†ï¸</span> 
                        <span class="move-btn" onclick="moveShop(${globalIdx}, 1)">â¬‡ï¸</span>
                    </div>
                    <label>å“é …åç¨±</label><input placeholder="å¦‚ï¼šBKKåŒ…" value="${s.item||''}" onchange="appData.shopping[${globalIdx}].item=this.value">
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>åˆ†é¡æ¨™ç±¤</label><input placeholder="å¦‚ï¼šä¼´æ‰‹ç¦®" value="${s.category||''}" onchange="appData.shopping[${globalIdx}].category=this.value; renderView('shopping');"></div>
                        <div style="flex:1"><label>é ä¼°åƒ¹æ ¼</label><input placeholder="å¦‚ï¼šà¸¿300" value="${s.price||''}" onchange="appData.shopping[${globalIdx}].price=this.value"></div>
                    </div>
                    <label>è³¼è²·åœ°é»</label><input placeholder="å¦‚ï¼šæ´½åœ–æ´½å¸‚é›†" value="${s.location||''}" onchange="appData.shopping[${globalIdx}].location=this.value">
                    <label>åƒè€ƒé€£çµ</label><input placeholder="https://..." value="${s.link||''}" onchange="appData.shopping[${globalIdx}].link=this.value">
                    <label>å‚™è¨»</label><textarea rows="2" placeholder="å¦‚ï¼šè¦è²·å¤§è±¡åœ–æ¡ˆçš„" onchange="appData.shopping[${globalIdx}].notes=this.value">${s.notes||''}</textarea>
                    
                    <div style="margin-top:10px; border:1px solid #eee; padding:10px; border-radius:10px; background:#fff;">
                        <label>ğŸ–¼ï¸ é˜²è²·éŒ¯æ©Ÿåˆ¶ (åŒ…è£å°ç…§åœ–)</label>
                        <label class="file-upload-btn">ğŸ“· é»æ“Šä¸Šå‚³<input type="file" accept="image/*" style="display:none;" onchange="encodeShoppingImage(${globalIdx}, this)"></label>
                        ${s.photo ? `<img src="${s.photo}" class="auto-img" style="max-height:100px; object-fit:contain; margin:10px auto;"> <button class="outline full-width" style="padding:5px;" onclick="appData.shopping[${globalIdx}].photo=''; renderView('shopping');">ç§»é™¤åœ–ç‰‡</button>` : ''}
                    </div>
                    <button class="danger full-width" style="margin-top:15px;" onclick="removeShop(${globalIdx})">ğŸ—‘ï¸ åˆªé™¤æ­¤é …ç›®</button>
                </div>`;
            }).join('');
        },
        flights: () => {
            document.getElementById('view-flights').innerHTML = getFlightViewHTML(appData.flights.outbound, 'å»ç¨‹ (Outbound)', 'ğŸ›«', '#4AA3DF') + getFlightViewHTML(appData.flights.inbound, 'å›ç¨‹ (Inbound)', 'ğŸ›¬', '#FF7043');
            ['outbound', 'inbound'].forEach(type => {
                const prefix = type === 'outbound' ? 'fl-out' : 'fl-in';
                const data = appData.flights[type];
                document.getElementById(`${prefix}-air`).value = data.airline || ''; document.getElementById(`${prefix}-no`).value = data.flightNo || ''; document.getElementById(`${prefix}-date`).value = data.date || ''; document.getElementById(`${prefix}-term`).value = data.terminal || ''; document.getElementById(`${prefix}-dep`).value = data.depTime || ''; document.getElementById(`${prefix}-arr`).value = data.arrTime || ''; document.getElementById(`${prefix}-board`).value = data.boardingTime || ''; document.getElementById(`${prefix}-gate`).value = data.gate || ''; document.getElementById(`${prefix}-pnr`).value = data.pnr || ''; document.getElementById(`${prefix}-fare`).value = data.fare || ''; document.getElementById(`${prefix}-passengers`).innerHTML = renderPassengerList(type);
            });
        },
        hotel: () => {
            document.getElementById('view-hotel').innerHTML = appData.hotels.map((h, i) => `
                <div class="card" style="border-left: 5px solid #66BB6A;">
                    <h3 style="margin-top:0; color:#2E7D32;">ğŸ¨ é£¯åº— ${i+1}ï¼š${h.name || 'æœªå‘½åé£¯åº—'}</h3>
                    <div style="background:#E8F5E9; padding:10px; border-radius:10px; margin-bottom:10px; text-align:center;"><b>${h.checkIn || '-'}</b> å…¥ä½ â¡ï¸ <b>${h.checkOut || '-'}</b> é€€æˆ¿</div>
                    <div class="info-row"><span class="info-label">ğŸ“ åœ°å€</span><span class="info-value">${h.address || '-'}</span></div>
                    <div class="info-row"><span class="info-label">ğŸš• äº¤é€šæŒ‡å¼•</span><span class="info-value">${h.transport || '-'}</span></div>
                    <div class="info-row"><span class="info-label">ğŸª é€±é‚Šç’°å¢ƒ</span><span class="info-value">${h.surroundings || '-'}</span></div>
                    ${h.voucher ? `<div style="margin-top:15px; border-top:1px dashed #ccc; padding-top:10px;"><b style="color:#555;">ğŸŸï¸ å…¥ä½æ†‘è­‰</b><img src="${h.voucher}" class="auto-img"></div>` : ''}
                    ${h.envPhoto ? `<div style="margin-top:15px; border-top:1px dashed #ccc; padding-top:10px;"><b style="color:#555;">ğŸ–¼ï¸ é£¯åº—ç’°å¢ƒ</b><img src="${h.envPhoto}" class="auto-img"></div>` : ''}
                </div>`).join('');

            document.getElementById('hotel-form-container').innerHTML = appData.hotels.map((h, i) => `
                <div class="edit-group" style="border-left: 5px solid #66BB6A;">
                    <div style="display:flex; justify-content:space-between; align-items:center;"><h4 style="margin:0;">ğŸ¨ é£¯åº— ${i+1}</h4><button class="danger icon-btn" style="font-size:0.8rem;" onclick="removeHotel(${i})">ğŸ—‘ï¸ åˆªé™¤</button></div>
                    <label>é£¯åº—åç¨±</label><input type="text" value="${h.name || ''}" onchange="appData.hotels[${i}].name=this.value">
                    <div style="display:flex; gap:10px;"><div style="flex:1"><label>å…¥ä½</label><input type="date" value="${h.checkIn || ''}" onchange="appData.hotels[${i}].checkIn=this.value"></div><div style="flex:1"><label>é€€æˆ¿</label><input type="date" value="${h.checkOut || ''}" onchange="appData.hotels[${i}].checkOut=this.value"></div></div>
                    <label>ğŸ“ åœ°å€</label><textarea rows="2" onchange="appData.hotels[${i}].address=this.value">${h.address || ''}</textarea>
                    <label>ğŸš• äº¤é€šæŒ‡å¼•</label><textarea rows="2" onchange="appData.hotels[${i}].transport=this.value">${h.transport || ''}</textarea>
                    <label>ğŸª é€±é‚Šç’°å¢ƒ</label><textarea rows="2" onchange="appData.hotels[${i}].surroundings=this.value">${h.surroundings || ''}</textarea>
                    
                    <div style="margin-top:15px; background:#fff; padding:10px; border-radius:10px; border:1px solid #ddd;">
                        <label>ğŸŸï¸ å…¥ä½æ†‘è­‰æˆªåœ–</label><label class="file-upload-btn">ğŸ“· é»æ“Šä¸Šå‚³æ†‘è­‰ç…§ç‰‡<input type="file" accept="image/*" style="display:none;" onchange="encodeHotelImage(${i}, this)"></label>
                        ${h.voucher ? `<img src="${h.voucher}" class="auto-img" style="max-height:150px; object-fit:contain; margin:10px auto;"> <button class="outline full-width" style="padding:5px;" onclick="appData.hotels[${i}].voucher=''; renderView('hotel');">ç§»é™¤æ†‘è­‰</button>` : ''}
                    </div>
                    
                    <div style="margin-top:15px; background:#fff; padding:10px; border-radius:10px; border:1px solid #ddd;">
                        <label>ğŸ–¼ï¸ é£¯åº—ç’°å¢ƒç…§ç‰‡</label><label class="file-upload-btn">ğŸ“· é»æ“Šä¸Šå‚³ç’°å¢ƒç…§ç‰‡<input type="file" accept="image/*" style="display:none;" onchange="encodeHotelEnvImage(${i}, this)"></label>
                        ${h.envPhoto ? `<img src="${h.envPhoto}" class="auto-img" style="max-height:150px; object-fit:contain; margin:10px auto;"> <button class="outline full-width" style="padding:5px;" onclick="appData.hotels[${i}].envPhoto=''; renderView('hotel');">ç§»é™¤ç…§ç‰‡</button>` : ''}
                    </div>
                </div>`).join('');
        },
        notes: () => {
            document.getElementById('view-notes').innerHTML = appData.notes.map(n => `
                <div class="card" style="background:#FFF9C4; padding:20px;">
                    <div style="font-weight:bold; color:#795548; margin-bottom:8px;">${n.date || 'ç„¡æ—¥æœŸ'}</div>
                    <div style="white-space: pre-wrap; color:#333; line-height:1.5;">${n.content || ''}</div>
                    ${n.link ? `<div style="margin-top:10px;">ğŸ”— <a href="${n.link}" target="_blank" style="color:var(--primary-dark); word-break:break-all;">${n.link}</a></div>` : ''}
                    ${n.photo ? `<div style="margin-top:10px;"><img src="${n.photo}" class="auto-img"></div>` : ''}
                </div>`).join('');
                
            document.getElementById('notes-form').innerHTML = appData.notes.map((n, i) => `
                <div class="edit-group">
                    <div style="text-align:right; margin-bottom:5px;"><span class="move-btn" onclick="moveNote(${i}, -1)">â¬†ï¸</span> <span class="move-btn" onclick="moveNote(${i}, 1)">â¬‡ï¸</span></div>
                    <input placeholder="æ—¥æœŸ (å¦‚ 2026-03-04)" value="${n.date || ''}" onchange="appData.notes[${i}].date=this.value">
                    <textarea placeholder="å¯«ä¸‹ä½ çš„ç­†è¨˜..." rows="3" onchange="appData.notes[${i}].content=this.value">${n.content || ''}</textarea>
                    <input placeholder="ğŸ”— è²¼ä¸Šç¶²å€é€£çµ (http://...)" value="${n.link || ''}" onchange="appData.notes[${i}].link=this.value">
                    <div style="margin-top:10px;">
                        <label class="file-upload-btn">ğŸ“· é»æ“Šä¸Šå‚³ç…§ç‰‡<input type="file" accept="image/*" style="display:none;" onchange="encodeImageBase64(this, (base64) => { appData.notes[${i}].photo = base64; renderView('notes'); })"></label>
                        ${n.photo ? `<img src="${n.photo}" class="auto-img"> <button class="outline full-width" style="margin-top:5px; padding:5px;" onclick="appData.notes[${i}].photo=''; renderView('notes');">ç§»é™¤ç…§ç‰‡</button>` : ''}
                    </div>
                    <button class="danger full-width" style="margin-top:15px;" onclick="removeNote(${i})">ğŸ—‘ï¸ åˆªé™¤ç­†è¨˜</button>
                </div>`).join('');
        }
    };

    // --- è¼”åŠ©åŠŸèƒ½ ---
    function addPassenger(type) { appData.flights[type].passengers.push({name:'', seat:''}); renderView('flights'); }
    function removePassenger(type, idx) { appData.flights[type].passengers.splice(idx, 1); renderView('flights'); }
    function addHotel() { appData.hotels.push({name:'', checkIn:'', checkOut:'', address:'', transport:'', surroundings:'', voucher:'', envPhoto:''}); renderView('hotel'); }
    function removeHotel(idx) { if(confirm('ç¢ºå®šåˆªé™¤é€™é–“é£¯åº—ï¼Ÿ')) { appData.hotels.splice(idx, 1); renderView('hotel'); } }
    
    // è¡Œç¨‹è¼”åŠ©
    function switchItineraryDay(idx) { currentItineraryDayIndex = idx; renderView('itinerary'); }
    function addDay() { appData.itinerary.push({date:'', summary:'æ–°çš„ä¸€å¤©', items:[]}); currentItineraryDayIndex = appData.itinerary.length - 1; renderView('itinerary'); }
    function removeDay(idx) { if(confirm(`ç¢ºå®šè¦åˆªé™¤ Day ${idx+1} çš„æ‰€æœ‰è¡Œç¨‹å—ï¼Ÿ`)) { appData.itinerary.splice(idx, 1); currentItineraryDayIndex = Math.max(0, currentItineraryDayIndex - 1); renderView('itinerary'); } }
    function addItm(dIdx) { appData.itinerary[dIdx].items.push({time:'', title:'', transport:'', hours:'', recommend:'', notes:'', photo:'', link:''}); renderView('itinerary'); }
    function removeItm(dIdx, iIdx) { appData.itinerary[dIdx].items.splice(iIdx, 1); renderView('itinerary'); }
    function moveItm(dIdx, iIdx, dir) { const items = appData.itinerary[dIdx].items; if(dir===-1 && iIdx>0) [items[iIdx], items[iIdx-1]] = [items[iIdx-1], items[iIdx]]; if(dir===1 && iIdx<items.length-1) [items[iIdx], items[iIdx+1]] = [items[iIdx+1], items[iIdx]]; renderView('itinerary'); }

    // ç¥¨åˆ¸è¼”åŠ©
    function addTicket() { appData.tickets.push({name:'', date:'', time:'', location:'', priceAdult:'', priceChild:'', voucher:''}); renderView('tickets'); }
    function removeTicket(idx) { if(confirm('åˆªé™¤æ­¤ç¥¨åˆ¸ï¼Ÿ')) { appData.tickets.splice(idx, 1); renderView('tickets'); } }
    function moveTicket(i, dir) { if(dir===-1 && i>0) [appData.tickets[i], appData.tickets[i-1]] = [appData.tickets[i-1], appData.tickets[i]]; if(dir===1 && i<appData.tickets.length-1) [appData.tickets[i], appData.tickets[i+1]] = [appData.tickets[i+1], appData.tickets[i]]; renderView('tickets'); }

    // æ³°æ–‡ç™¼éŸ³è¼”åŠ©
    function addPhrase() { appData.phrases.unshift({category:'è‡ªè¨‚', zh:'', th:''}); renderView('phrases'); }
    function removePhrase(idx) { if(confirm('ç¢ºå®šåˆªé™¤æ­¤å¥å‹ï¼Ÿ')) { appData.phrases.splice(idx, 1); renderView('phrases'); } }
    function movePhrase(i, dir) { if(dir===-1 && i>0) [appData.phrases[i], appData.phrases[i-1]] = [appData.phrases[i-1], appData.phrases[i]]; if(dir===1 && i<appData.phrases.length-1) [appData.phrases[i], appData.phrases[i+1]] = [appData.phrases[i+1], appData.phrases[i]]; renderView('phrases'); }

    // å¿…è²·è¼”åŠ©
    function switchShoppingTab(cat) { currentShoppingCategory = cat; renderView('shopping'); }
    function addShoppingItem() { const cat = currentShoppingCategory === 'å…¨éƒ¨' ? '' : currentShoppingCategory; appData.shopping.unshift({item:'', price:'', category: cat, location:'', link:'', notes:'', photo:'', done:false}); renderView('shopping'); }
    function toggleShop(idx) { appData.shopping[idx].done = !appData.shopping[idx].done; saveToLocal(); renderView('shopping'); }
    function removeShop(idx) { appData.shopping.splice(idx, 1); renderView('shopping'); }
    function moveShop(globalIdx, dir) {
        if (currentShoppingCategory === 'å…¨éƒ¨') {
            if (dir === -1 && globalIdx > 0) [appData.shopping[globalIdx], appData.shopping[globalIdx - 1]] = [appData.shopping[globalIdx - 1], appData.shopping[globalIdx]];
            if (dir === 1 && globalIdx < appData.shopping.length - 1) [appData.shopping[globalIdx], appData.shopping[globalIdx + 1]] = [appData.shopping[globalIdx + 1], appData.shopping[globalIdx]];
        } else {
            const catIndices = []; appData.shopping.forEach((s, i) => { if ((s.category || 'æœªåˆ†é¡') === currentShoppingCategory) catIndices.push(i); });
            const pos = catIndices.indexOf(globalIdx);
            if (dir === -1 && pos > 0) { const swapIdx = catIndices[pos - 1]; [appData.shopping[globalIdx], appData.shopping[swapIdx]] = [appData.shopping[swapIdx], appData.shopping[globalIdx]]; }
            if (dir === 1 && pos < catIndices.length - 1) { const swapIdx = catIndices[pos + 1]; [appData.shopping[globalIdx], appData.shopping[swapIdx]] = [appData.shopping[swapIdx], appData.shopping[globalIdx]]; }
        }
        renderView('shopping');
    }

    // ç­†è¨˜è¼”åŠ©
    function addNote() { appData.notes.unshift({date:'', content:'', link:'', photo:''}); renderView('notes'); }
    function removeNote(idx) { if(confirm('åˆªé™¤é€™å‰‡ç­†è¨˜ï¼Ÿ')) { appData.notes.splice(idx, 1); renderView('notes'); } }
    function moveNote(i, dir) { if(dir===-1 && i>0) [appData.notes[i], appData.notes[i-1]] = [appData.notes[i-1], appData.notes[i]]; if(dir===1 && i<appData.notes.length-1) [appData.notes[i], appData.notes[i+1]] = [appData.notes[i+1], appData.notes[i]]; renderView('notes'); }

    // --- åœ–ç‰‡å£“ç¸®å™¨ ---
    function encodeImageBase64(input, callback) {
        const file = input.files[0]; if(!file) return; const reader = new FileReader();
        reader.onload = e => {
            const img = new Image(); img.onload = () => {
                const canvas = document.createElement('canvas'); const MAX_WIDTH = 800;
                let width = img.width; let height = img.height;
                if (width > MAX_WIDTH) { height = height * (MAX_WIDTH / width); width = MAX_WIDTH; }
                canvas.width = width; canvas.height = height;
                const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, width, height);
                callback(canvas.toDataURL('image/jpeg', 0.6));
            }; img.src = e.target.result;
        }; reader.readAsDataURL(file);
    }
    function encodeHotelImage(idx, input) { encodeImageBase64(input, (base64) => { appData.hotels[idx].voucher = base64; renderView('hotel'); }); }
    function encodeHotelEnvImage(idx, input) { encodeImageBase64(input, (base64) => { appData.hotels[idx].envPhoto = base64; renderView('hotel'); }); }
    function encodeItineraryImage(dIdx, iIdx, input) { encodeImageBase64(input, (base64) => { appData.itinerary[dIdx].items[iIdx].photo = base64; renderView('itinerary'); }); }
    function encodeTicketImage(idx, input) { encodeImageBase64(input, (base64) => { appData.tickets[idx].voucher = base64; renderView('tickets'); }); }
    function encodeShoppingImage(idx, input) { encodeImageBase64(input, (base64) => { appData.shopping[idx].photo = base64; renderView('shopping'); }); }

    function zoomMap(delta) { const img = document.getElementById('mrt-img'); let curr = parseInt(img.style.width) || 100; if(delta===0) img.style.width = '100%'; else img.style.width = (curr + delta) + '%'; }
    function mockTranslate() { window.open('https://translate.google.com/?sl=zh-TW&tl=th'); }
    function exportJSON() { const a = document.createElement('a'); a.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(appData)); a.download = '2026_Bangkok_Adventure_Backup.json'; a.click(); }
    function handleFileImport(input) { const reader = new FileReader(); reader.onload = (e) => { appData = JSON.parse(e.target.result); saveToLocal(); location.reload(); }; reader.readAsText(input.files[0]); }
    function resetApp() { if(confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸï¼')) { localStorage.clear(); location.reload(); } }
    function renderView(s) { if(renderers[s]) renderers[s](); }

    document.addEventListener('DOMContentLoaded', () => {
        initAudio();
        renderView('itinerary');
        renderView('tickets');
        renderView('phrases');
        renderView('shopping');
        renderView('flights');
        renderView('hotel');
        renderView('notes');
    });
</script>

</body>
</html>